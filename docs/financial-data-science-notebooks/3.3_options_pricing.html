

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Options Pricing &#8212; Financial Data Science Python Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '3.3_options_pricing';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Value at Risk" href="3.4_value_at_risk.html" />
    <link rel="prev" title="Interest Rate Risk" href="3.2_bond_returns.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
  
    <p class="title logo__title">Financial Data Science Python Notebooks</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    FINANCIAL DATA SCIENCE
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.1_stock_prices.html">Stock Prices</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.2_jegadeesh_titman.html">Jegadeesh-Titman Rolling Portfolios</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.3_fama_french.html">Fama-French Portfolio Sorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.4_fama_macbeth.html">Fama-Macbeth Cross-sectional Regressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.5_contrarian_trading.html">Contrarian Trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.6_quant_factors.html">Quant Factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.7_event_study.html">Event Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.1_economic_indicators.html">Economic Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.2_regression_diagnostics.html">Linear Regression Diagonostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.3_time_series.html">Time Series Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.4_approximate_factors.html">Approximate Factor Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.5_economic_states.html">State Space Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.1_term_structure.html">Term Structure of Interest Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.2_bond_returns.html">Interest Rate Risk</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Options Pricing</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.4_value_at_risk.html">Value at Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.5_covariance_matrix.html">Covariance Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.6_market_microstructure.html">Market Microstructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.7_event_risk.html">Event Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.1_network_graphs.html">Supply Chain Network Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.2_community_detection.html">Industry Community Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.3_graph_centrality.html">Input-Output Graph Centrality</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.4_link_prediction.html">Product Market Link Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.5_spatial_regression.html">Earnings Spatial Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.1_fomc_topics.html">FOMC Topic Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.2_management_sentiment.html">Management Sentiment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.3_business_textual.html">Business Textual Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.1_classification_models.html">Machine Learning: Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.2_regression_models.html">Machine Learning: Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.3_deep_learning.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.4_convolutional_net.html">Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.5_recurrent_net.html">Recurrent Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.6_reinforcement_learning.html">Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.7_language_modeling.html">Language Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.1_large_language_models.html">Large Language Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.2_llm_finetuning.html">LLM Fine-tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.3_llm_prompting.html">LLM Prompting</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.4_llm_agents.html">LLM Agents</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/terence-lim/financial-data-science-notebooks.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/terence-lim/financial-data-science-notebooks.git/issues/new?title=Issue%20on%20page%20%2F3.3_options_pricing.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/3.3_options_pricing.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Options Pricing</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#options">Options</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#option-strategies">Option strategies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exotic-options">Exotic options</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-option-pricing">Binomial option pricing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#no-arbitrage">No-arbitrage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-neutral-pricing">Risk neutral pricing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-tree">Binomial tree</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-scholes-merton-model">Black-Scholes-Merton model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implied-volatility">Implied volatility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#volatility-smile">Volatility smile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-greeks">The “Greeks”</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation">Monte Carlo simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#antithetic-variates">Antithetic Variates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-variates">Control Variates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-option-prices">Simulating option prices</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="options-pricing">
<h1>Options Pricing<a class="headerlink" href="#options-pricing" title="Permalink to this heading">#</a></h1>
<p><em>Derivatives are financial weapons of mass destruction</em> - Warren Buffett</p>
<p>We explore the basics of options, common strategies, and the foundational pricing models used in the financial markets. The price of an option is influenced by various factors, including the underlying asset’s price, the time remaining until expiration, the volatility of the asset, interest rates, and the strike price.
The valuation of options can be approached through techniques like binomial tree pricing and Monte Carlo simulations, or models like the Black-Scholes-Merton model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># By: Terence Lim, 2020-2025 (terence-lim.github.io)</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">finds.utils</span> <span class="kn">import</span> <span class="n">row_formatted</span>
<span class="kn">from</span> <span class="nn">finds.readers</span> <span class="kn">import</span> <span class="n">Alfred</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">credentials</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#%matplotlib qt</span>
</pre></div>
</div>
</div>
</div>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this heading">#</a></h2>
<p>An <strong>European</strong> call or put option grants the buyer the right to buy or sell an asset at a specified price on a given expiration date. An <strong>American</strong> call or put option, on the other hand, allows the buyer to exercise the option at any time before or on the expiration date. The specified date is known as the <strong>expiration</strong> (or <strong>maturity</strong>) date, while the price at which the asset can be traded is referred to as the <strong>strike</strong> (or <strong>exercise</strong>) price.</p>
<p>Options can be categorized based on their <strong>moneyness</strong>, meaning the relationship between the option’s strike price and the current price of the underlying asset. An option is considered <strong>in-the-money</strong> if it would result in a positive payoff if exercised immediately, <strong>out-of-the-money</strong> if it would lead to a negative payoff, and <strong>at-the-money</strong> if the strike price equals the current market price.</p>
<p>The value of an option depends on several factors, including:</p>
<ul class="simple">
<li><p>The price of the underlying asset (S)</p></li>
<li><p>The strike price (K)</p></li>
<li><p>The risk-free rate (r)</p></li>
<li><p>The volatility of the asset’s price (<span class="math notranslate nohighlight">\(\sigma\)</span>)</p></li>
<li><p>The time to maturity (T)</p></li>
<li><p>Any dividends to be paid during the life of the option (q)</p></li>
</ul>
<p>Put-call parity defines the relationship between the prices of European call and put options with identical strike prices and expiration dates: <span class="math notranslate nohighlight">\(S - C = PV(K) - P\)</span>.</p>
<section id="option-strategies">
<h3>Option strategies<a class="headerlink" href="#option-strategies" title="Permalink to this heading">#</a></h3>
<p>Various trading strategies involve entering positions in multiple options simultaneously, and sometimes incorporating the underlying asset.</p>
<ul class="simple">
<li><p>A <strong>protective put</strong> strategy involves buying a put option while holding the underlying asset. This combined position offers a payoff similar to that of a call option, along with the amount of cash equivalent to the present value of the strike price.</p></li>
<li><p>A <strong>covered call</strong> strategy entails owning an asset and selling a call option on it. Typically, the call option is out-of-the-money, and the strategy generates income from the option premium while sacrificing potential upside gains beyond the strike price.</p></li>
<li><p>A <strong>bull spread</strong> is employed by an investor expecting an increase in the asset’s price. The strategy involves buying a European call with a lower strike price (K1) and selling a European call with a higher strike price (K2).</p></li>
<li><p>A <strong>bear spread</strong> involves buying a European put option with a higher strike price (K2) and selling a European put option with a lower strike price (K1).</p></li>
<li><p>A <strong>box spread</strong> is a portfolio consisting of a bull spread (using call options) and a bear spread (using put options). Both spreads use the same strike prices and expiration dates.</p></li>
<li><p>A <strong>butterfly spread</strong> involves a combination of three options, created using either calls or puts. A common version involves one long call with a lower strike price (K1), one long call with a higher strike price (K3), and two short calls at a strike price (K2), where <span class="math notranslate nohighlight">\(K2 = (K1 + K3) / 2\)</span>.</p></li>
<li><p>A <strong>calendar spread</strong> strategy consists of buying a long call option with an expiration date at time T* and selling a short call option with an earlier expiration date, both at the same strike price (K).</p></li>
<li><p>A <strong>straddle</strong> is created by holding both a long call and a long put with the same strike price and expiration date.</p></li>
<li><p>A <strong>strangle</strong> is similar to a straddle but reduces the cost by selecting a call option with a higher strike price than the put option.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define call and put payoffs at maturity</span>
<span class="k">def</span> <span class="nf">call_payoff</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">-</span> <span class="n">K</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="n">K</span> <span class="k">else</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">put_payoff</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">K</span> <span class="o">-</span> <span class="n">s</span> <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">K</span> <span class="k">else</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># helpers to plot final payoff of option strategy</span>
<span class="k">def</span> <span class="nf">plot_payoff</span><span class="p">(</span><span class="n">payoff</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;helper to plot final payoff over range of stock price S&quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">([</span><span class="n">payoff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">zeros</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">*</span><span class="mf">0.4</span>    <span class="c1"># jigger so can display separate</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_ls</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;helper to label as long or short position&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;long&#39;</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;short&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define and plot the options strategies</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">options_strategy</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">puts</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stocks</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_ls</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span><span class="si">}</span><span class="s2"> call </span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">calls</span><span class="o">*</span><span class="n">call_payoff</span><span class="p">(</span><span class="n">K</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_ls</span><span class="p">(</span><span class="n">puts</span><span class="p">)</span><span class="si">}</span><span class="s2"> put </span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">puts</span><span class="o">*</span><span class="n">put_payoff</span><span class="p">(</span><span class="n">K</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="s2">&quot;stock&quot;</span><span class="p">:</span> <span class="n">stocks</span><span class="o">*</span><span class="n">s</span><span class="p">}</span>

<span class="n">plot_payoff</span><span class="p">(</span><span class="n">options_strategy</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">puts</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stocks</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Protective Put&#39;</span><span class="p">)</span>

<span class="n">plot_payoff</span><span class="p">(</span><span class="n">options_strategy</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">calls</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">stocks</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Covered Call&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bull_spread</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">K2</span> <span class="o">&gt;</span> <span class="n">K1</span><span class="p">,</span> <span class="s2">&quot;K2 must be greater than K1&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;long call </span><span class="si">{</span><span class="n">K1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">call_payoff</span><span class="p">(</span><span class="n">K1</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;short call </span><span class="si">{</span><span class="n">K2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="o">-</span><span class="n">call_payoff</span><span class="p">(</span><span class="n">K2</span><span class="p">)(</span><span class="n">s</span><span class="p">)}</span>

<span class="n">plot_payoff</span><span class="p">(</span><span class="n">bull_spread</span><span class="p">(</span><span class="n">K1</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">K2</span><span class="o">=</span><span class="mi">105</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bull Spread&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bear_spread</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">K2</span> <span class="o">&gt;</span> <span class="n">K1</span><span class="p">,</span> <span class="s2">&quot;K2 must be greater than K1&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;short put </span><span class="si">{</span><span class="n">K1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="o">-</span><span class="n">put_payoff</span><span class="p">(</span><span class="n">K1</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;long put </span><span class="si">{</span><span class="n">K2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">put_payoff</span><span class="p">(</span><span class="n">K2</span><span class="p">)(</span><span class="n">s</span><span class="p">)}</span>

<span class="n">plot_payoff</span><span class="p">(</span><span class="n">bear_spread</span><span class="p">(</span><span class="n">K1</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">K2</span><span class="o">=</span><span class="mi">105</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bear Spread&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">box_spread</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">K2</span> <span class="o">&gt;</span> <span class="n">K1</span><span class="p">,</span> <span class="s2">&quot;K2 must be greater than K1&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;short put </span><span class="si">{</span><span class="n">K1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="o">-</span><span class="n">put_payoff</span><span class="p">(</span><span class="n">K1</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;long call </span><span class="si">{</span><span class="n">K1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">call_payoff</span><span class="p">(</span><span class="n">K1</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;long put </span><span class="si">{</span><span class="n">K2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">put_payoff</span><span class="p">(</span><span class="n">K2</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;short call </span><span class="si">{</span><span class="n">K2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="o">-</span><span class="n">call_payoff</span><span class="p">(</span><span class="n">K2</span><span class="p">)(</span><span class="n">s</span><span class="p">)}</span>

<span class="n">plot_payoff</span><span class="p">(</span><span class="n">box_spread</span><span class="p">(</span><span class="n">K1</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">K2</span><span class="o">=</span><span class="mi">105</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Box Spread&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">butterfly_spread</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">K3</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">K3</span> <span class="o">&gt;</span> <span class="n">K1</span><span class="p">,</span> <span class="s2">&quot;K3 must be greater than K1&quot;</span>
    <span class="n">K2</span> <span class="o">=</span> <span class="p">(</span><span class="n">K1</span> <span class="o">+</span> <span class="n">K3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;long call </span><span class="si">{</span><span class="n">K1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">call_payoff</span><span class="p">(</span><span class="n">K1</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;short calls </span><span class="si">{</span><span class="n">K2</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">call_payoff</span><span class="p">(</span><span class="n">K2</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;long call </span><span class="si">{</span><span class="n">K3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">call_payoff</span><span class="p">(</span><span class="n">K3</span><span class="p">)(</span><span class="n">s</span><span class="p">)}</span>

<span class="n">plot_payoff</span><span class="p">(</span><span class="n">butterfly_spread</span><span class="p">(</span><span class="n">K1</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">K3</span><span class="o">=</span><span class="mi">110</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Butterfly Spread&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">straddle</span><span class="p">(</span><span class="n">K</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;long put </span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">put_payoff</span><span class="p">(</span><span class="n">K</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;long call </span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">call_payoff</span><span class="p">(</span><span class="n">K</span><span class="p">)(</span><span class="n">s</span><span class="p">)}</span>                      
<span class="n">plot_payoff</span><span class="p">(</span><span class="n">straddle</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Straddle&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">strangle</span><span class="p">(</span><span class="n">K1</span><span class="p">,</span> <span class="n">K2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">K2</span> <span class="o">&gt;</span> <span class="n">K1</span><span class="p">,</span> <span class="s2">&quot;K2 must be greater than K1&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;long put </span><span class="si">{</span><span class="n">K1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">put_payoff</span><span class="p">(</span><span class="n">K1</span><span class="p">)(</span><span class="n">s</span><span class="p">),</span>
                      <span class="sa">f</span><span class="s2">&quot;long call </span><span class="si">{</span><span class="n">K2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">call_payoff</span><span class="p">(</span><span class="n">K2</span><span class="p">)(</span><span class="n">s</span><span class="p">)}</span>
<span class="n">plot_payoff</span><span class="p">(</span><span class="n">strangle</span><span class="p">(</span><span class="n">K1</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> <span class="n">K2</span><span class="o">=</span><span class="mi">105</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Strangle&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Options Strategies Payoffs&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5fa81529f7cda3caff912576772526a55ae4aba5fcdb0891bdad4ab7e0b4532d.png" src="_images/5fa81529f7cda3caff912576772526a55ae4aba5fcdb0891bdad4ab7e0b4532d.png" />
</div>
</div>
</section>
<section id="exotic-options">
<h3>Exotic options<a class="headerlink" href="#exotic-options" title="Permalink to this heading">#</a></h3>
<p>In addition to standard European and American options (which are termed plain vanilla options), there are <strong>exotic options</strong> (or simply <strong>exotics</strong>) which have more complex structures and non-standard features.</p>
<ul class="simple">
<li><p>A <strong>Bermudan</strong> option is one where the exercise of the option is restricted to certain predetermined dates.</p></li>
<li><p>A <strong>forward start</strong> option is an option that starts at a future date and is usually at-the-money at the time it begins.</p></li>
<li><p>A <strong>gap</strong> option is a European option where the price triggering a payoff is different from the price used to calculate the payoff.</p></li>
<li><p>A <strong>cliquet</strong> option is a series of forward start options, each with its own rules for determining strike prices.</p></li>
<li><p><strong>Binary</strong> options (also called <strong>digital</strong> options) pay a fixed amount or asset if the option’s price exceeds (or falls below) the strike price, otherwise, they pay nothing.</p></li>
<li><p><strong>Asian</strong> options provide payoffs based on the arithmetic average of the asset’s price during the option’s life.</p></li>
<li><p>A <strong>lookback</strong> option’s payoff depends on the maximum or minimum price reached by the asset during its lifetime. A floating lookback option gives a payoff based on the difference between the final asset price and the minimum (or maximum) price reached, while a fixed lookback option bases the payoff on the difference between the maximum (or minimum) price and the strike price.</p></li>
<li><p><strong>Barrier</strong> options have payoffs that depend on whether the price of the asset reaches a specific level, with various types like down-and-out, down-and-in, up-and-out, and up-and-in.</p></li>
<li><p>A <strong>compound</strong> option is an option on another option, which results in two strike prices and two expiration dates.</p></li>
<li><p>An <strong>asset-exchange</strong> option allows the holder to exchange one asset for another.</p></li>
<li><p>A <strong>volatility swap</strong> is a forward contract based on the realized volatility of an asset during a specified period. Traders exchange the realized volatility at the end of the period for a pre-specified volatility rate.</p></li>
<li><p>The exercise of a <strong>Bermudan</strong> option is restricted to certain dates.</p></li>
<li><p>A <strong>forward start</strong> option is an option that will begin at a future time. It is usually stated that the option will be at-the-money at the time it starts.</p></li>
<li><p>A <strong>gap</strong> option is a European call or put option where the price triggering a payoff is different from the price used in calculating the payoff.</p></li>
<li><p>A <strong>cliquet</strong> option is a series of forward start options with certain rules for determining the strike prices.</p></li>
<li><p><strong>Binary</strong> call (put) options may a fixed amount of cash or an asset when its price is above (below) the strike price, or nothing otherwise.  Cash-or-nothing optinos are sometimes referred to as <strong>digital</strong> options.</p></li>
<li><p><strong>Asian</strong> options provide a payoff dependent on an arithmetic aver-age of the underlying asset price during the life of the option.</p></li>
<li><p>The payoff from a <strong>lookback</strong> option depends on the maximum or minimum asset price reached during the life of the option. A floating lookback call (put) gives a payoff equal difference between the final asset price and minimum (maximum) price. The payoff of a fixed lookback call (put) is based on the difference betwen the maximum (minimum) price and the strike price.</p></li>
<li><p><strong>Barrier</strong> options come into existence or ceases to exist depending on whether the asset price reaches a particular barrier.  There are down-and-out, down-and-in, up-and-out and up-and-in variants.</p></li>
<li><p>A <strong>compound</strong> option is an option on another option. Thus, there are two strike prices and two maturity dates.</p></li>
<li><p>In an <strong>asset-exchange</strong> option, the holder has the right to exchange one asset for another.</p></li>
<li><p>A <strong>volatility swap</strong> is a forward contract on the realized volatility of an asset during a certain period. A trader agrees to exchange a pre-specified volatility for the realized volatility at the end of the period.</p></li>
</ul>
</section>
</section>
<section id="binomial-option-pricing">
<h2>Binomial option pricing<a class="headerlink" href="#binomial-option-pricing" title="Permalink to this heading">#</a></h2>
<p>The <strong>binomial option pricing model</strong>, proposed by Cox, Ross, and Rubinstein (1979), is widely used to value American-style options and other derivatives.</p>
<section id="no-arbitrage">
<h3>No-arbitrage<a class="headerlink" href="#no-arbitrage" title="Permalink to this heading">#</a></h3>
<p>The no-arbitrage principle assumes there are no opportunities for riskless profit in the market. The <strong>law of one price</strong> stipulates that if two portfolios produce the same cash flows at the same times, they should have the same price. Binomial trees use this no-arbitrage principle to model option pricing.</p>
<p>For example, assuming a non-dividend-paying stock with price <span class="math notranslate nohighlight">\(S\)</span>, the stock can either increase to <span class="math notranslate nohighlight">\(Su\)</span> or decrease to <span class="math notranslate nohighlight">\(Sd\)</span> within time T. The portfolio is structured with:</p>
<ul class="simple">
<li><p>A short position in the derivative, and</p></li>
<li><p>A position in the stock which we set equal to <span class="math notranslate nohighlight">\(\Delta = \dfrac{f_u - f_d}{S u - S d}\)</span></p></li>
</ul>
<p>The value of the portfolio at time T is</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(S u \Delta - f_u\)</span> if the stock price increases, and</p></li>
<li><p><span class="math notranslate nohighlight">\(S d \Delta - f_d\)</span> if the stock price decreases.</p></li>
</ul>
<p>The value of the portfolio today is <span class="math notranslate nohighlight">\(S \Delta - f\)</span>, where f is the value of the derivative today. Suppose r is the risk-free rate for maturity T. For no arbitrage, we must have</p>
<p><span class="math notranslate nohighlight">\(S \Delta - f = \dfrac{f_ud - f_du}{u - d}e^{-rT}\)</span></p>
<p>Substituting for <span class="math notranslate nohighlight">\(\Delta\)</span>, gives:</p>
<div class="math notranslate nohighlight">
\[f = e^{-rT}[pf_u + (1 - p)f_d]\]</div>
<p>where <span class="math notranslate nohighlight">\(p = \dfrac{e^{rT} - d}{u - d}\)</span></p>
</section>
<section id="risk-neutral-pricing">
<h3>Risk neutral pricing<a class="headerlink" href="#risk-neutral-pricing" title="Permalink to this heading">#</a></h3>
<p>Suppose we choose to interpret the variable p as the probability of an upward movement (with 1 - p being the probability of a downward movement), then the expected stock price grows at the risk-free rate. It also means that <span class="math notranslate nohighlight">\(p\)</span> is the probability of an upward movement in a risk-neutral world.</p>
<p>The <strong>risk-neutral</strong> valuation approach applies a probability <span class="math notranslate nohighlight">\(p\)</span> for upward movements and values the option by its expected payoff, discounted at the risk-free rate. Risk-neutral pricing assumes that all assets earn the risk-free rate of return in the market. Put another way, a risk-neutral world is one where all tradable assets have an expected return equal to the risk-free interest rate. The probabilities of different outcomes in a risk-neutral world are therefore based on this assumption, and a risk-neutral investor has no preference between assets with different risks. This methodology simplifies the valuation process by treating all market participants as indifferent to risk.</p>
<p>It should be emphasized that the risk-neutral valuation is nothing more than an artificial way of valuing derivatives. We are not assuming that the world is actually risk-neutral. We are instead arguing that the price of a derivative is the same in the real world as it would be in the risk-neutral world</p>
</section>
<section id="binomial-tree">
<h3>Binomial tree<a class="headerlink" href="#binomial-tree" title="Permalink to this heading">#</a></h3>
<p>In practice, the binomial model is extended to multi-step trees, where each step reflects changes in the asset’s price over time. Parameters like <span class="math notranslate nohighlight">\(\Delta t\)</span> (time between steps), and <span class="math notranslate nohighlight">\(u\)</span>, <span class="math notranslate nohighlight">\(d\)</span> (upward and downward movements) are chosen based on the asset’s volatility:</p>
<ul>
<li><p>the length of a tree step as <span class="math notranslate nohighlight">\(\Delta t\)</span></p></li>
<li><p>the parameters u and d should be chosen to reflect the volatility of
the stock price. If we denote the volatility per year by <span class="math notranslate nohighlight">\(\sigma\)</span>, then appropriate values for the parameters are</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(u = e^{\sigma \sqrt{\Delta t}}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(u = e^{-\sigma \sqrt{\Delta t}}\)</span></p></li>
</ul>
<p>where <span class="math notranslate nohighlight">\(\Delta t\)</span> is measured in years.</p>
</li>
<li><p>hence
$<span class="math notranslate nohighlight">\(f = e^{-r \Delta t} [p f_u + (1 - p) f_d]\)</span><span class="math notranslate nohighlight">\(
where \)</span>p = \dfrac{e^{r \Delta t} - d}{u - d}$</p></li>
<li><p>the delta, or position taken in the stock to hedge a short posion
in the derivative, is <span class="math notranslate nohighlight">\(\Delta = \dfrac{f_u - f_d}{Su - Sd}\)</span></p></li>
</ul>
<p><strong>Dividends</strong>: For assets paying dividends, the probability <span class="math notranslate nohighlight">\(p\)</span> is adjusted to account for the dividend yield <span class="math notranslate nohighlight">\(q\)</span>:</p>
<div class="math notranslate nohighlight">
\[p = \dfrac{e^{(r - q)\Delta t} - d}{u - d}\]</div>
<p><strong>Currency Options</strong>: A currency can be considered as an asset providing a yield at the foreign risk-free rate. Therefore, the analysis we presented for a stock paying a continuous dividend yield applies, with q equal to the foreign risk-free rate.</p>
<p><strong>Futures</strong>: Because it costs nothing to enter into a futures contract, the return on a futures contract in a risk-neutral world must be zero. This means we can treat a futures contract like a stock, paying a continuous dividend yield equal to the risk free rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="n">payoff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">american</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">delta_t</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">steps</span>    
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta_t</span><span class="p">))</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">delta_t</span><span class="p">))</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta_t</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">delta_t</span><span class="o">=</span><span class="n">delta_t</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">payoff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;STEP </span><span class="si">{:&lt;5d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span>    <span class="c1"># to label output of each step</span>

        <span class="c1"># initialize price vectors at last step</span>
        <span class="n">prices</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">steps</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                           <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stock&#39;</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">downs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">d</span><span class="o">**</span><span class="n">downs</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="p">(</span><span class="n">steps</span><span class="o">-</span><span class="n">downs</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span>      <span class="c1"># price after number of downs</span>
            <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">downs</span><span class="p">,</span> <span class="s1">&#39;stock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
            <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">downs</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">payoff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># option value at expiry</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">row_formatted</span><span class="p">(</span><span class="n">prices</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">label</span><span class="p">(</span><span class="n">steps</span><span class="p">)),</span>
                            <span class="n">default</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="p">))</span>
        
        <span class="c1"># roll back one time step at a time</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

            <span class="c1"># update all scenarios in this time step</span>
            <span class="k">for</span> <span class="n">downs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>

                <span class="c1"># stock price after this number of downs</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">d</span><span class="o">**</span><span class="n">downs</span> <span class="o">*</span> <span class="n">u</span><span class="o">**</span><span class="p">(</span><span class="n">step</span> <span class="o">-</span> <span class="n">downs</span><span class="p">)</span> <span class="o">*</span> <span class="n">S</span>  
                <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">downs</span><span class="p">,</span> <span class="s1">&#39;stock&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
                
                <span class="c1"># value of option is max of roll back or exercise (if American)</span>
                <span class="n">exercise</span> <span class="o">=</span> <span class="n">payoff</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">if</span> <span class="n">american</span> <span class="k">else</span> <span class="mi">0</span>  <span class="c1"># if exercise American</span>
                <span class="n">f_u</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">downs</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">]</span>        <span class="c1"># option value after up</span>
                <span class="n">f_d</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">downs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">]</span>    <span class="c1"># option value after down</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">delta_t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">f_u</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="n">f_d</span><span class="p">)</span>
                <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">downs</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">exercise</span><span class="p">)</span>
                <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">downs</span><span class="p">,</span> <span class="s1">&#39;delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_u</span> <span class="o">-</span> <span class="n">f_d</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span><span class="o">*</span><span class="n">u</span> <span class="o">-</span> <span class="n">S</span><span class="o">*</span><span class="n">d</span><span class="p">)</span>

            <span class="c1"># Display this time step</span>
            <span class="n">prices</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">row_formatted</span><span class="p">(</span><span class="n">prices</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">label</span><span class="p">(</span><span class="n">step</span><span class="p">)),</span>
                                <span class="n">default</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;option&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">steps</span><span class="p">])</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;STEPS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>European call option in 2 steps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure 14.3 of FRM Part I Exam Book &quot;Valuation and Risk Models&quot;</span>
<span class="n">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">payoff</span><span class="o">=</span><span class="n">call_payoff</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STEP 2            0        1        2
stock       41.2995  29.0000  20.3635
option      11.2995   0.0000   0.0000
delta        0.0000   0.0000   0.0000

STEP 1            0        1
stock       34.6076  24.3010
option       5.5483   0.0000
delta        1.0963   0.0000

STEP 0            0
stock       29.0000
option       2.7243
delta        0.5383
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>STEPS</th>
      <th>value</th>
      <th>u</th>
      <th>d</th>
      <th>p</th>
      <th>delta_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>2.7243</td>
      <td>1.1934</td>
      <td>0.838</td>
      <td>0.4984</td>
      <td>0.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>European put option in 2 steps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure 14.4 of FRM Part I Exam Book &quot;Valuation and Risk Models&quot;</span>
<span class="n">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">payoff</span><span class="o">=</span><span class="n">put_payoff</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">30</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STEP 2            0        1        2
stock       41.2995  29.0000  20.3635
option       0.0000   1.0000   9.6365
delta        0.0000   0.0000   0.0000

STEP 1            0        1
stock       34.6076  24.3010
option       0.4941   5.2523
delta       -0.0970  -0.8380

STEP 0            0
stock       29.0000
option       2.8377
delta       -0.4617
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>STEPS</th>
      <th>value</th>
      <th>u</th>
      <th>d</th>
      <th>p</th>
      <th>delta_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>2.8377</td>
      <td>1.1934</td>
      <td>0.838</td>
      <td>0.4984</td>
      <td>0.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>American put option in 4 steps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure 14.5 of FRM Part I Exam Book &quot;Valuation and Risk Models&quot;</span>
<span class="n">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
              <span class="n">payoff</span><span class="o">=</span><span class="n">put_payoff</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span> <span class="n">american</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STEP 2            0        1        2
stock       41.2995  29.0000  20.3635
option       0.0000   1.0000   9.6365
delta        0.0000   0.0000   0.0000

STEP 1            0        1
stock       34.6076  24.3010
option       0.4941   5.6990
delta       -0.0970  -0.8380

STEP 0            0
stock       29.0000
option       3.0584
delta       -0.5050
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>STEPS</th>
      <th>value</th>
      <th>u</th>
      <th>d</th>
      <th>p</th>
      <th>delta_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>3.0584</td>
      <td>1.1934</td>
      <td>0.838</td>
      <td>0.4984</td>
      <td>0.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>American put option in 4 steps</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure 14.6 of FRM Part I Exam Book &quot;Valuation and Risk Models&quot;</span>
<span class="n">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">29</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
              <span class="n">payoff</span><span class="o">=</span><span class="n">put_payoff</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span> <span class="n">american</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STEP 4            0        1        2        3        4
stock       47.8129  37.2367  29.0000  22.5852  17.5894
option       0.0000   0.0000   1.0000   7.4148  12.4106
delta        0.0000   0.0000   0.0000   0.0000   0.0000

STEP 3            0        1        2        3
stock       42.1948  32.8613  25.5924  19.9314
option       0.0000   0.4974   4.4076  10.0686
delta        0.0000  -0.1376  -0.8825  -0.6873

STEP 2            0        1        2
stock       37.2367  29.0000  22.5852
option       0.2474   2.4387   7.4148
delta       -0.0684  -0.5379  -0.7788

STEP 1            0        1
stock       32.8613  25.5924
option       1.3356   4.8958
delta       -0.3015  -0.6846

STEP 0            0
stock       29.0000
option       3.0966
delta       -0.4898
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>STEPS</th>
      <th>value</th>
      <th>u</th>
      <th>d</th>
      <th>p</th>
      <th>delta_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>3.0966</td>
      <td>1.1331</td>
      <td>0.8825</td>
      <td>0.4988</td>
      <td>0.25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>European call on index with dividend yield</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure 14.7 of FRM Part I Exam Book &quot;Valuation and Risk Models&quot;</span>
<span class="n">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">2500</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
              <span class="n">payoff</span><span class="o">=</span><span class="n">call_payoff</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">2500</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STEP 3              0          1          2          3
stock       3004.1734  2657.8778  2351.5002  2080.4391
option       504.1734   157.8778     0.0000     0.0000
delta          0.0000     0.0000     0.0000     0.0000

STEP 2              0          1          2
stock       2825.7257  2500.0000  2211.8212
option       328.7911    78.2792     0.0000
delta          1.1303     0.5153     0.0000

STEP 1              0          1
stock       2657.8778  2351.5002
option       202.0979    38.8125
delta          0.8177     0.2555

STEP 0              0
stock       2500.0000
option       119.5793
delta          0.5330
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>STEPS</th>
      <th>value</th>
      <th>u</th>
      <th>d</th>
      <th>p</th>
      <th>delta_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>119.5793</td>
      <td>1.0632</td>
      <td>0.9406</td>
      <td>0.4983</td>
      <td>0.1667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>American call option on foreign currency</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure 14.8 of FRM Part I Exam Book &quot;Valuation and Risk Models&quot;</span>
<span class="n">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mf">0.78</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
              <span class="n">payoff</span><span class="o">=</span><span class="n">call_payoff</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">0.8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STEP 4           0       1       2       3       4
stock       0.9916  0.8794  0.7800  0.6918  0.6136
option      0.1916  0.0794  0.0000  0.0000  0.0000
delta       0.0000  0.0000  0.0000  0.0000  0.0000

STEP 3           0       1       2       3
stock       0.9338  0.8282  0.7346  0.6515
option      0.1239  0.0318  0.0000  0.0000
delta       1.1972  0.8483  0.0000  0.0000

STEP 2           0       1       2
stock       0.8794  0.7800  0.6918
option      0.0685  0.0127  0.0000
delta       0.9837  0.3394  0.0000

STEP 1           0       1
stock       0.8282  0.7346
option      0.0350  0.0051
delta       0.5955  0.1358

STEP 0           0
stock       0.7800
option      0.0170
delta       0.3191
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>STEPS</th>
      <th>value</th>
      <th>u</th>
      <th>d</th>
      <th>p</th>
      <th>delta_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>0.017</td>
      <td>1.0618</td>
      <td>0.9418</td>
      <td>0.4021</td>
      <td>0.25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>American put option on futures contract</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Figure 14.9 of FRM Part I Exam Book &quot;Valuation and Risk Models&quot;</span>
<span class="n">binomial_tree</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">38</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">9</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
              <span class="n">payoff</span><span class="o">=</span><span class="n">put_payoff</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span> <span class="n">american</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STEP 3            0        1        2        3
stock       51.2946  41.9965  34.3838  28.1511
option       0.0000   0.0000   5.6162  11.8489
delta        0.0000   0.0000   0.0000   0.0000

STEP 2            0        1        2
stock       46.4133  38.0000  31.1118
option       0.0000   2.9190   8.8882
delta        0.0000  -0.7377  -0.8187

STEP 1            0        1
stock       41.9965  34.3838
option       1.5172   5.9925
delta       -0.3834  -0.7841

STEP 0            0
stock       38.0000
option       3.8282
delta       -0.5879
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>STEPS</th>
      <th>value</th>
      <th>u</th>
      <th>d</th>
      <th>p</th>
      <th>delta_t</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>3.8282</td>
      <td>1.1052</td>
      <td>0.9048</td>
      <td>0.475</td>
      <td>0.25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="black-scholes-merton-model">
<h2>Black-Scholes-Merton model<a class="headerlink" href="#black-scholes-merton-model" title="Permalink to this heading">#</a></h2>
<p>The <strong>Black-Scholes-Merton model</strong>, introduced in two papers in 1973, revolutionized options pricing and remains one of the most widely used models for pricing European options. Based on assumptions like lognormal stock price distributions, continuous trading, and no-arbitrage conditions, the model provides a formula for calculating the price of call and put options.  In one of the papers, Black and Scholes used the capital asset pricing model (CAPM) to derive the relationship between the return from a stock and the return from an option on the stock. In the other, Merton used no-arbitrage arguments similar to those of the binomial tree approach. Both derived  that the price evolution of derivatives satisfies the same partial differential equation:</p>
<div class="math notranslate nohighlight">
\[\dfrac{\partial V}{\partial t} + \dfrac{1}{2}\sigma^2 S^2 \dfrac{\partial^2S}{\partial S^2} + rS \dfrac{\partial V}{\partial S} - rV = 0\]</div>
<p>To value an option, we simply apply boundary conditions. For a European call option with time to maturity T and strike price K, the boundary condition is that the value of the option is max(S - K, 0) at time T. For a European put, this boundary condition is max(K - S, 0). Other derivatives give rise to other boundary conditions.</p>
<p>The solutions for the prices of a European call and put are the Black-Scholes-Merton formulas:</p>
<div class="math notranslate nohighlight">
\[C = S e^{-qT} \Phi(d_1) - Ke^{-rT} \Phi(d_2)\]</div>
<div class="math notranslate nohighlight">
\[p = Ke^{-rT} \Phi(-d_2) - S e^{-qT} \Phi(-d_1)\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(d_1 = \dfrac{\ln(S_0/K) + (r - q + \sigma^2/2)T}{\sigma\sqrt{T}}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(d_2 = \dfrac{\ln(S_0/K) + (r - q- \sigma^2/2)T}{\sigma\sqrt{T}} = d_1 - \sigma\sqrt{T}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(S\)</span> is the current stock price,</p></li>
<li><p>K is the strike price,</p></li>
<li><p>T is the time to maturity in years,</p></li>
<li><p>r is the risk-free rate per year (continuously compounded),</p></li>
<li><p>q is the dividend yield (or foreign risk-free rate for currency options)</p></li>
<li><p><span class="math notranslate nohighlight">\(\sigma\)</span> is an estimated volatility per year over the next T years,</p></li>
<li><p><span class="math notranslate nohighlight">\(\Phi\)</span> is the cumulative normal distribution function</p></li>
</ul>
<p>Suppose discreate dividends are expected bo be paid with ex-dates during the life of the option. The option can be valued by replacing stock price S with S - PV(D), the present value of those dividends.</p>
<p>Since American call options on a non-dividend paying stock should never be exercised early, the pricing formula for American call options on non-dividend paying stocks as well as for European call options are the same. But it may be optimal to exercise early when there are discrete dividends, but only immediately before an ex-dividend date. American put options on stocks and all American options on stock indices, currencies, and futures should not be valued as European options. Binomial trees can be used in these cases.</p>
<p><strong>Black-Scholes-Merton option pricing formulas</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_d1</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;helper to compute d1 term in Black-Scholes-Merton formula&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">K</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">q</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton call option value&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">S</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">K</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton put option value&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">K</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span> <span class="o">-</span> <span class="n">S</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">call</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">56</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>  <span class="c1"># 8.3069</span>
<span class="nb">print</span><span class="p">(</span><span class="n">put</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">56</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">18</span><span class="o">/</span><span class="mi">12</span><span class="p">))</span>   <span class="c1"># 7.9715</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.306909593824336
7.971518773537515
</pre></div>
</div>
</div>
</div>
<section id="implied-volatility">
<h3>Implied volatility<a class="headerlink" href="#implied-volatility" title="Permalink to this heading">#</a></h3>
<p><strong>Implied volatility</strong> is the volatility figure derived from an option’s market price and used to infer expectations about future price movements.</p>
<p>The Chicago Board Options Exchange has developed indices that track volatilities. The most popular of these is the SPX VIX index, which tracks the volatilities of 30-day options on the S&amp;P 500. Traders monitor implied volatilities carefully and often use them to communicate prices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alf</span> <span class="o">=</span> <span class="n">Alfred</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;fred&#39;</span><span class="p">][</span><span class="s1">&#39;api_key&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">convert_date</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">vix</span> <span class="o">=</span> <span class="n">alf</span><span class="p">(</span><span class="s1">&#39;VIXCLS&#39;</span><span class="p">)</span>
<span class="n">sp500_sq</span> <span class="o">=</span> <span class="n">alf</span><span class="p">(</span><span class="s1">&#39;SP500&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">diff</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;SP500 squared returns&#39;</span><span class="p">)</span>
<span class="n">sp500</span> <span class="o">=</span> <span class="n">alf</span><span class="p">(</span><span class="s1">&#39;SP500&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">252</span><span class="o">*</span><span class="n">sp500_sq</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">vix</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Volatility&#39;</span><span class="p">)</span>
<span class="n">bx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">sp500</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">bx</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">)</span>
<span class="n">bx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;SP500 Price Level&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Daily SP500 and VIX&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16758ecae9c8e193a9a4354fc439f23de463f6442203dac468e8c198aafdd757.png" src="_images/16758ecae9c8e193a9a4354fc439f23de463f6442203dac468e8c198aafdd757.png" />
</div>
</div>
</section>
<section id="volatility-smile">
<h3>Volatility smile<a class="headerlink" href="#volatility-smile" title="Permalink to this heading">#</a></h3>
<p>If the assumptions underlying the Black-Scholes-Merton model held exactly, all options on an asset would have the same implied volatility at all times. In practice, implied volatility varies with the strike price and time to maturity. The <strong>volatility smile</strong> refers to this observed pattern, where options with extreme strike prices (both high and low) tend to have higher implied volatilities. Because of put-call parity, the implied volatility of a European call option is the same as that of a European put option when they have the same strike price and time to maturity.</p>
<p>In equity options, the volatility smile generally slopes downward. This means that out-of-the-money puts and in-the-money calls tend to have higher implied volatilities, while out-of-the-money calls and in-the-money puts have lower implied volatilities. This phenomenon is often referred to as a volatility skew. There is a negative correlation between equity prices and volatility, which means that as stock prices fall, volatility increases, and as stock prices rise, volatility decreases.</p>
<p>For foreign currency options, the volatility smile takes a U-shape. Both out-of-the-money and in-the-money options tend to have higher implied volatilities compared to at-the-money options. The volatility of exchange rates is not constant and can be subject to sudden jumps, often driven by central bank actions. These nonconstant volatilities and jumps make extreme price movements more likely.</p>
<p>Traders also often use a volatility term structure, where the implied volatility of an option depends on its time to maturity. When volatility smiles and term structures are combined, they form a <strong>volatility surface</strong>. This surface shows implied volatility as a function of both the strike price and the time to maturity. When quoting option prices, traders interpolate between known implied volatilities to estimate the implied volatility for the option in question. This estimated volatility is then plugged into the Black-Scholes-Merton model to calculate the option price. This approach helps address the fact that the market does not always price options in line with the assumptions of the Black-Scholes-Merton model.</p>
</section>
<section id="the-greeks">
<h3>The “Greeks”<a class="headerlink" href="#the-greeks" title="Permalink to this heading">#</a></h3>
<p>The Greek letters, or <strong>Greeks</strong> as they are often called, are metrics used to measure the sensitivity of option prices to different factors such as changes in the price of the underlying asset, volatility, time decay, and interest rates.</p>
<ul class="simple">
<li><p><strong>Delta</strong> measures the sensitivity to changes in the price of the underlying asset:</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\Delta_c = e^{-qt} \Phi(d_1)\)</span></p>
<p><span class="math notranslate nohighlight">\(\Delta_p = e^{-qt} [\Phi(d_1) - 1]\)</span></p>
<ul class="simple">
<li><p><strong>Gamma</strong> measures the sensitivity of a portfolio’s delta to changes in the price of the underlying asset:</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\Gamma = \dfrac{e^{-qt}}{S \sigma\sqrt{t}}\phi(d_1)\)</span></p>
<ul class="simple">
<li><p><strong>Theta</strong> measures the sensitity to time to expiration</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\Theta_c = -\dfrac{S\sigma e^{-qt}}{2\sqrt{t}}\phi(d_1) - rKe^{-rt}\Phi(d_2) + qSe^{-qt}\Phi(d_1)\)</span></p>
<p><span class="math notranslate nohighlight">\(\Theta_p = -\dfrac{S\sigma e^{-qt}}{2\sqrt{t}}\phi(d_1) + rKe^{-rt}\Phi(-d_2) - qSe^{-qt}\Phi(-d_1)\)</span></p>
<ul class="simple">
<li><p><strong>Vega</strong> measures the sensitivity to the implied volatility</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(V = S e^{-qt} \sqrt{t} \phi(d_1)\)</span></p>
<ul class="simple">
<li><p><strong>Rho</strong> measures the sensitivity to changes in the level of interest rate</p></li>
</ul>
<p><span class="math notranslate nohighlight">\(\rho_c = K t e^{-rt} \Phi(d_2)\)</span></p>
<p><span class="math notranslate nohighlight">\(\rho_p = K t e^{-rt} \Phi(-d_2)\)</span></p>
<p>Any of the Greek letters for a portfolio of derivatives dependent on
the same asset can be calculated as the weighted sum of the Greek letters
for each portfolio component.</p>
<p>The Black-Scholes-Merton analysis can be used to show that
$<span class="math notranslate nohighlight">\(\Theta + (r-q) S \Delta + \dfrac{1}{2} \sigma^2 S^2 \Gamma = (r-q) C\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper to plot a greek over range of stock price S&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">plot_greek</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">greek</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
               <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;helper to plot a greek over range of stock price S&quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">greek</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
    <span class="c1">#ax.set_xlabel(&#39;Stock Price&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">label</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Define and plot options sensitivities</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot options sensitivities</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># call option parameters</span>
<span class="n">opt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">105</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delta_call</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton call option delta&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">delta_put</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton put option delta&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">delta_call</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">))</span>  <span class="c1"># 0.5358</span>

<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">delta_call</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Call Delta&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>
<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">delta_put</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Put Delta&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vega</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton call or put option delta&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vega</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">))</span>  <span class="c1"># 39.73</span>

<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">vega</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Vega&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gamma</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton call or put option gamma&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gamma</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">))</span>  <span class="c1"># 0.0159</span>

<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Gamma&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">theta_call</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton call option theta&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)))</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">))</span> <span class="o">+</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">theta_put</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton put option theta&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)))</span>
            <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">K</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">))</span> <span class="o">+</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">theta_call</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">))</span>  <span class="c1"># 6.73</span>

<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">theta_call</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Call Theta&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>

<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">theta_put</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Put Theta&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C5&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rho_call</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton call option rho&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">K</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rho_put</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Black-Scholes-Merton put option rho&quot;&quot;&quot;</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">_d1</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">K</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rho_call</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">))</span>  <span class="c1"># 44</span>

<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">rho_call</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Call Rho&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C6&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>

<span class="n">plot_greek</span><span class="p">(</span><span class="n">greek</span><span class="o">=</span><span class="n">rho_put</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Put Rho&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;C7&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Sensitivity of Options Prices (the &quot;Greeks&quot;)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5357925584332519
39.73355715246575
0.0158934228609863
-6.727614629584682
44.02299963816157
</pre></div>
</div>
<img alt="_images/24f09e2c17857e17a1c4b4812b8e693cdcc78ef1b3239d6d4be8b83b8f6ab6d2.png" src="_images/24f09e2c17857e17a1c4b4812b8e693cdcc78ef1b3239d6d4be8b83b8f6ab6d2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check that: theta + r S delta + 1/2 sigma^2 S^2 gamma = r call</span>
<span class="n">S</span> <span class="o">=</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="n">theta_call</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span> <span class="o">+</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">delta_call</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">)</span> <span class="o">+</span>
      <span class="mf">0.5</span> <span class="o">*</span> <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">gamma</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">),</span>
      <span class="n">opt</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">call</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="o">**</span><span class="n">opt</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3822502482065442 0.38225024820654485
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="monte-carlo-simulation">
<h2>Monte Carlo simulation<a class="headerlink" href="#monte-carlo-simulation" title="Permalink to this heading">#</a></h2>
<p>Simulation is an effective way to estimate expectations that are difficult or impossible to compute analytically. Consider a random variable <span class="math notranslate nohighlight">\(X\)</span> that can be simulated (for example, from a normal distribution), and a function <span class="math notranslate nohighlight">\(g\)</span> that can be evaluated at realizations of <span class="math notranslate nohighlight">\(X\)</span>. To estimate the expected value of <span class="math notranslate nohighlight">\(g(X)\)</span>, we take multiple simulated draws. Since these draws are independent and identically distributed (iid), the expectation can be approximated as:</p>
<div class="math notranslate nohighlight">
\[
\hat{E}[g(X)] = \frac{1}{b} \sum_{i=1}^{b} g(X_i)
\]</div>
<p>where <span class="math notranslate nohighlight">\(b\)</span> is the number of simulated samples. By the Law of Large Numbers (LLN), the approximation improves as <span class="math notranslate nohighlight">\(b\)</span> increases:</p>
<div class="math notranslate nohighlight">
\[
\lim_{b \to \infty} \hat{E}[g(X)] = E[g(X)]
\]</div>
<p>Additionally, the Central Limit Theorem (CLT) implies that the distribution of the simulated estimate approaches a normal distribution as the number of simulations grows. The variance of the simulated estimate can be approximated by:</p>
<div class="math notranslate nohighlight">
\[
V[\hat{E}[g(X)]] = \frac{\sigma^2_b}{b}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma^2_b\)</span> is the sample variance. This variance can be estimated as:</p>
<div class="math notranslate nohighlight">
\[
\sigma^2_g = \frac{1}{b} \sum_{i=1}^{b} (g(X_i) - E[g(X_i)])^2
\]</div>
<p>which is the standard variance estimator for iid samples. The standard error of the estimate, <span class="math notranslate nohighlight">\(\frac{\sigma_g}{\sqrt{b}}\)</span>, indicates the accuracy of the approximation. This allows us to adjust <span class="math notranslate nohighlight">\(b\)</span> to achieve any desired level of precision.</p>
<section id="antithetic-variates">
<h3>Antithetic Variates<a class="headerlink" href="#antithetic-variates" title="Permalink to this heading">#</a></h3>
<p>Antithetic variates are a technique to improve the accuracy of simulation by generating a second set of random variables that are negatively correlated with the original set of random variables. These pairs of variables are created using a single uniform random number. Each uniform variable <span class="math notranslate nohighlight">\(U_i\)</span> generates its counterpart <span class="math notranslate nohighlight">\(1 - U_i\)</span>, both of which are then mapped through the inverse cumulative distribution function (CDF) to generate correlated random variables.</p>
<p>Using antithetic variates reduces the simulation error, but only if the function <span class="math notranslate nohighlight">\(g(X)\)</span> is monotonic, which ensures that the negative correlation between the paired variables results in reduced error. The benefit of this approach comes from the negative correlation, which decreases the standard error and thus increases the accuracy of the simulation.</p>
</section>
<section id="control-variates">
<h3>Control Variates<a class="headerlink" href="#control-variates" title="Permalink to this heading">#</a></h3>
<p>Control variates are another technique to enhance simulation accuracy. A control variate is a derived random variable <span class="math notranslate nohighlight">\(h(X_i)\)</span>, which is correlated with the primary variable <span class="math notranslate nohighlight">\(g(X_i)\)</span> but has a known mean, typically zero. To be effective, a good control variate must satisfy two criteria:</p>
<ol class="arabic simple">
<li><p>It should be computationally inexpensive to construct from the data <span class="math notranslate nohighlight">\(x_i\)</span>, offering a more cost-effective alternative to increasing the number of simulations.</p></li>
<li><p>It should exhibit a high correlation with the function <span class="math notranslate nohighlight">\(g(X)\)</span>, making it useful for reducing the error in the primary estimate.</p></li>
</ol>
<p>The optimal parameter <span class="math notranslate nohighlight">\(\beta\)</span>, which minimizes the approximation error, is typically found using regression:</p>
<div class="math notranslate nohighlight">
\[
g(x_i) = \alpha + \beta h(x_i)
\]</div>
<p>By adjusting <span class="math notranslate nohighlight">\(\beta\)</span>, the control variate technique helps improve the accuracy of the estimated value of <span class="math notranslate nohighlight">\(g(X)\)</span>.</p>
</section>
<section id="simulating-option-prices">
<h3>Simulating option prices<a class="headerlink" href="#simulating-option-prices" title="Permalink to this heading">#</a></h3>
<p>To simulate the price of a financial option, we assume that the logarithm of the stock price follows a normal distribution. The log of the stock price at time <span class="math notranslate nohighlight">\(T\)</span>, denoted <span class="math notranslate nohighlight">\(s_T\)</span>, is given by:</p>
<div class="math notranslate nohighlight">
\[
s_T = s_0 + T \left( r_f - \frac{\sigma^2}{2} \right) + \sqrt{T} x_i
\]</div>
<p>where <span class="math notranslate nohighlight">\(x_i\)</span> is a random variable sampled from a normal distribution <span class="math notranslate nohighlight">\(N(0, \sigma^2)\)</span>, <span class="math notranslate nohighlight">\(r_f\)</span> is the risk-free rate, and <span class="math notranslate nohighlight">\(\sigma^2\)</span> is the variance of the stock return. The final stock price is then <span class="math notranslate nohighlight">\(S_T = \exp(s_T)\)</span>, and the present value of the option’s payoff is:</p>
<div class="math notranslate nohighlight">
\[
C = \exp(-r_f T) \max(S_T - K, 0)
\]</div>
<p>where <span class="math notranslate nohighlight">\(K\)</span> is the strike price of the option. The expected price of a call option can be estimated by averaging the simulated payoffs:</p>
<div class="math notranslate nohighlight">
\[
E[C] = \overline{C} = \frac{1}{b} \sum_{i=1}^{b} C_i
\]</div>
<p>where <span class="math notranslate nohighlight">\(C_i\)</span> represents the simulated payoff for each instance. This approach is particularly useful for complex pricing scenarios where analytical solutions may not exist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># helpers for random number generator and monte carlo simulation</span>
<span class="k">class</span> <span class="nc">RNG</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Helper to generate random normal variables, with optional antithetic variates&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">antithetic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ppf</span><span class="o">=</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppf</span> <span class="o">=</span> <span class="n">ppf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antithetic</span> <span class="o">=</span> <span class="n">antithetic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># to track if antithetic pair available to return next</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">shape</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">_shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">antithetic</span><span class="p">:</span>  <span class="c1"># generate half as many rv&#39;s, by returning 1-rv</span>
            <span class="n">new</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">new</span><span class="p">,))</span>
            <span class="n">rem</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">new</span><span class="p">[:</span><span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>   <span class="c1"># if last pair unused</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span><span class="p">]</span>
            <span class="c1">#out.extend(new)</span>
            <span class="c1">#out.extend(rem)</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">rem</span><span class="p">)],</span> <span class="n">rem</span><span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">last</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">last</span><span class="p">])</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prev</span> <span class="o">=</span> <span class="n">last</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">_shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">_shape</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">monte_carlo</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper to price European call option by Monte Carlo Simulation</span>
<span class="sd">    Args:</span>
<span class="sd">      control : True price of European put option, as control variate</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">rng</span><span class="o">.</span><span class="n">antithetic</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Both&#39;</span> <span class="k">if</span> <span class="n">control</span> <span class="k">else</span> <span class="s1">&#39;Antithetic&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Control&#39;</span> <span class="k">if</span> <span class="n">control</span> <span class="k">else</span> <span class="s1">&#39;Standard&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">50</span><span class="o">*</span><span class="mi">4</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]:</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">rng</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sigma</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">S</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="n">K</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># to apply control variate method</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">K</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">control</span>  <span class="c1"># error of put price</span>
            <span class="n">ols</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># compute best hedge to minimize error</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="n">ols</span><span class="o">.</span><span class="n">slope</span> <span class="o">*</span> <span class="n">error</span>
        <span class="n">result</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Price</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                         <span class="n">StdErr</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">))</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                         <span class="n">elapsed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tic</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

<span class="n">RNG</span><span class="p">(</span><span class="n">antithetic</span><span class="o">=</span><span class="kc">True</span><span class="p">)((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>   <span class="c1"># generate normal r.v.&#39;s with antithetic variates</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-0.72886259,  0.72886259,  0.25403329],
       [-0.25403329, -0.81873243,  0.81873243]])
</pre></div>
</div>
</div>
</div>
<p>Standard simulation</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">2500</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.164</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">RNG</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">monte_carlo</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Standard</th>
      <th>Price</th>
      <th>StdErr</th>
      <th>elapsed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>50</th>
      <td>297.91</td>
      <td>54.77</td>
      <td>0.0005</td>
    </tr>
    <tr>
      <th>200</th>
      <td>247.65</td>
      <td>25.97</td>
      <td>0.0003</td>
    </tr>
    <tr>
      <th>800</th>
      <td>283.95</td>
      <td>15.23</td>
      <td>0.0003</td>
    </tr>
    <tr>
      <th>3200</th>
      <td>279.62</td>
      <td>7.59</td>
      <td>0.0004</td>
    </tr>
    <tr>
      <th>12800</th>
      <td>278.25</td>
      <td>3.73</td>
      <td>0.0009</td>
    </tr>
    <tr>
      <th>51200</th>
      <td>279.45</td>
      <td>1.85</td>
      <td>0.0027</td>
    </tr>
    <tr>
      <th>204800</th>
      <td>278.93</td>
      <td>0.93</td>
      <td>0.0112</td>
    </tr>
    <tr>
      <th>819200</th>
      <td>278.31</td>
      <td>0.46</td>
      <td>0.0491</td>
    </tr>
    <tr>
      <th>3276800</th>
      <td>278.59</td>
      <td>0.23</td>
      <td>0.2490</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Antithetic Variates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">RNG</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">antithetic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">monte_carlo</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Antithetic</th>
      <th>Price</th>
      <th>StdErr</th>
      <th>elapsed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>50</th>
      <td>280.86</td>
      <td>54.41</td>
      <td>0.0004</td>
    </tr>
    <tr>
      <th>200</th>
      <td>242.12</td>
      <td>25.04</td>
      <td>0.0006</td>
    </tr>
    <tr>
      <th>800</th>
      <td>276.97</td>
      <td>14.15</td>
      <td>0.0013</td>
    </tr>
    <tr>
      <th>3200</th>
      <td>284.38</td>
      <td>7.63</td>
      <td>0.0013</td>
    </tr>
    <tr>
      <th>12800</th>
      <td>277.30</td>
      <td>3.72</td>
      <td>0.0014</td>
    </tr>
    <tr>
      <th>51200</th>
      <td>279.28</td>
      <td>1.87</td>
      <td>0.0052</td>
    </tr>
    <tr>
      <th>204800</th>
      <td>278.15</td>
      <td>0.93</td>
      <td>0.0225</td>
    </tr>
    <tr>
      <th>819200</th>
      <td>278.46</td>
      <td>0.46</td>
      <td>0.1279</td>
    </tr>
    <tr>
      <th>3276800</th>
      <td>278.48</td>
      <td>0.23</td>
      <td>0.4977</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Control Variates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">control</span> <span class="o">=</span> <span class="n">put</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>   <span class="c1"># Black-Scholes-Merton put price</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">RNG</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
<span class="n">monte_carlo</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Control</th>
      <th>Price</th>
      <th>StdErr</th>
      <th>elapsed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>50</th>
      <td>263.59</td>
      <td>47.04</td>
      <td>0.0010</td>
    </tr>
    <tr>
      <th>200</th>
      <td>251.85</td>
      <td>22.76</td>
      <td>0.0003</td>
    </tr>
    <tr>
      <th>800</th>
      <td>287.49</td>
      <td>13.52</td>
      <td>0.0002</td>
    </tr>
    <tr>
      <th>3200</th>
      <td>279.92</td>
      <td>6.76</td>
      <td>0.0003</td>
    </tr>
    <tr>
      <th>12800</th>
      <td>278.43</td>
      <td>3.32</td>
      <td>0.0010</td>
    </tr>
    <tr>
      <th>51200</th>
      <td>279.01</td>
      <td>1.64</td>
      <td>0.0022</td>
    </tr>
    <tr>
      <th>204800</th>
      <td>279.02</td>
      <td>0.83</td>
      <td>0.0109</td>
    </tr>
    <tr>
      <th>819200</th>
      <td>278.22</td>
      <td>0.41</td>
      <td>0.0441</td>
    </tr>
    <tr>
      <th>3276800</th>
      <td>278.64</td>
      <td>0.21</td>
      <td>0.3454</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Both Antithetic and Control Variates</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">control</span> <span class="o">=</span> <span class="n">put</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>    <span class="c1"># Black-Scholes-Merton put price</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">RNG</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span> <span class="n">antithetic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">monte_carlo</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">control</span><span class="o">=</span><span class="n">control</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Both</th>
      <th>Price</th>
      <th>StdErr</th>
      <th>elapsed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>50</th>
      <td>286.14</td>
      <td>45.71</td>
      <td>0.0006</td>
    </tr>
    <tr>
      <th>200</th>
      <td>227.29</td>
      <td>22.03</td>
      <td>0.0008</td>
    </tr>
    <tr>
      <th>800</th>
      <td>277.91</td>
      <td>12.32</td>
      <td>0.0003</td>
    </tr>
    <tr>
      <th>3200</th>
      <td>286.51</td>
      <td>6.79</td>
      <td>0.0008</td>
    </tr>
    <tr>
      <th>12800</th>
      <td>276.56</td>
      <td>3.31</td>
      <td>0.0018</td>
    </tr>
    <tr>
      <th>51200</th>
      <td>279.47</td>
      <td>1.66</td>
      <td>0.0058</td>
    </tr>
    <tr>
      <th>204800</th>
      <td>277.88</td>
      <td>0.83</td>
      <td>0.0244</td>
    </tr>
    <tr>
      <th>819200</th>
      <td>278.41</td>
      <td>0.41</td>
      <td>0.1019</td>
    </tr>
    <tr>
      <th>3276800</th>
      <td>278.41</td>
      <td>0.21</td>
      <td>0.5569</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>References:</strong></p>
<p>F. Black and M. Scholes, “The Pricing of Options and Corporate Liabilities,” Journal of Political Economy, 81 (May/June 1973): 637–59</p>
<p>R. C. Merton, “Theory of Rational Option Pricing,” Bell Journal of Economics and Management Science 4 (Spring 1973): 141–183.</p>
<p>Cox, J. C., Ross, S. A., &amp; Rubinstein, M. (1979). Option Pricing: A Simplified Approach. Journal of Financial Economics, 7(3), 229-263.</p>
<p>Terence Lim, Andrew W. Lo, Robert C. Merton and Myron S. Scholes (2006), “The Derivatives Sourcebook”, Foundations and Trends in Finance: Vol. 1: No. 5–6, pp 365-572. <a class="reference external" href="http://dx.doi.org/10.1561/0500000005">http://dx.doi.org/10.1561/0500000005</a></p>
<p>FRM Part I Exam Book Financial Markets and Products Ch. 14-15</p>
<p>FRM Part I Exam Book Quantitative Analysis Ch. 13</p>
<p>FRM Part I Exam Book Valuation and Risk Models Ch. 14-16</p>
<p>FRM Part II Exam Book Market Risk Measurement and Management Ch. 15</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="3.2_bond_returns.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Interest Rate Risk</p>
      </div>
    </a>
    <a class="right-next"
       href="3.4_value_at_risk.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Value at Risk</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#options">Options</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#option-strategies">Option strategies</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exotic-options">Exotic options</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-option-pricing">Binomial option pricing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#no-arbitrage">No-arbitrage</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#risk-neutral-pricing">Risk neutral pricing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-tree">Binomial tree</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-scholes-merton-model">Black-Scholes-Merton model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implied-volatility">Implied volatility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#volatility-smile">Volatility smile</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-greeks">The “Greeks”</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation">Monte Carlo simulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#antithetic-variates">Antithetic Variates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#control-variates">Control Variates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulating-option-prices">Simulating option prices</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Terence Lim
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020-2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>


<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Event Study &#8212; Financial Data Science Python Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '1.7_event_study';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Economic Indicators" href="2.1_economic_indicators.html" />
    <link rel="prev" title="Quant Factors" href="1.6_quant_factors.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
  
    <p class="title logo__title">Financial Data Science Python Notebooks</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    FINANCIAL DATA SCIENCE
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1.1_stock_prices.html">Stock Prices</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.2_jegadeesh_titman.html">Jegadeesh-Titman Rolling Portfolios</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.3_fama_french.html">Fama-French Portfolio Sorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.4_fama_macbeth.html">Fama-Macbeth Cross-sectional Regressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.5_contrarian_trading.html">Contrarian Trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="1.6_quant_factors.html">Quant Factors</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Event Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.1_economic_indicators.html">Economic Indicators</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.2_regression_diagnostics.html">Linear Regression Diagonostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.3_time_series.html">Time Series Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.4_approximate_factors.html">Approximate Factor Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="2.5_economic_states.html">State Space Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.1_term_structure.html">Term Structure of Interest Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.2_bond_returns.html">Interest Rate Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.3_options_pricing.html">Options Pricing</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.4_value_at_risk.html">Value at Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.5_covariance_matrix.html">Covariance Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.6_market_microstructure.html">Market Microstructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="3.7_event_risk.html">Event Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.1_network_graphs.html">Supply Chain Network Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.2_community_detection.html">Industry Community Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.3_graph_centrality.html">Input-Output Graph Centrality</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.4_link_prediction.html">Product Market Link Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="4.5_spatial_regression.html">Earnings Spatial Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.1_fomc_topics.html">FOMC Topic Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.2_management_sentiment.html">Management Sentiment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="5.3_business_textual.html">Business Textual Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.1_classification_models.html">Machine Learning: Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.2_regression_models.html">Machine Learning: Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.3_deep_learning.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.4_convolutional_net.html">Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.5_recurrent_net.html">Recurrent Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.6_reinforcement_learning.html">Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="6.7_language_modeling.html">Language Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.1_large_language_models.html">Large Language Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.2_llm_finetuning.html">Fine-tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.3_llm_prompting.html">Prompting</a></li>
<li class="toctree-l1"><a class="reference internal" href="7.4_llm_agents.html">Agents</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/terence-lim/financial-data-science-notebooks.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/terence-lim/financial-data-science-notebooks.git/issues/new?title=Issue%20on%20page%20%2F1.7_event_study.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/1.7_event_study.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Event Study</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abnormal-returns">Abnormal returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#announcement-effect">Announcement effect</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finds-eventstudy-module">FinDS <code class="docutils literal notranslate"><span class="pre">eventstudy</span></code> module</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-transforms">Fourier transforms</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-sectional-correlations">Cross-sectional Correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fast-fourier-transforms">Fast Fourier Transforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution-theorem">Convolution Theorem</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-testing">Multiple testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bonferroni-correction">Bonferroni correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holm-s-step-down-procedure">Holm’s step-down procedure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#benjamin-hochberg-procedure">Benjamin-Hochberg procedure</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="event-study">
<h1>Event Study<a class="headerlink" href="#event-study" title="Permalink to this heading">#</a></h1>
<p><em>All strange and terrible events are welcome, but comforts we despise</em> - Cleopatra</p>
<p>Event studies are a fundamental tool in financial research used to assess how specific events impact stock returns, see Mackinlay (1997). These events, such as mergers, earnings announcements, or regulatory changes, can cause deviations in stock prices known as abnormal returns. By comparing stock returns to a market benchmark, event studies help analysts determine whether an event had a statistically significant impact on a company’s stock price.</p>
<p>This notebook explores key methodologies used in event studies, including the computation of abnormal returns, cumulative abnormal returns, and buy-and-hold abnormal returns. Additionally, it delves into the announcement effect, which examines how stock prices react immediately around an event, and investigates potential pre- and post-announcement drifts. To account for overlapping event windows and cross-sectional dependencies, we apply statistical corrections based on the work of Kolari et al. (2010, 2018).</p>
<p>We also introduce frequency domain methods, leveraging the Fourier Transform and Convolution Theorem to efficiently compute cross-correlations between time series. Finally, we address the multiple testing problem, ensuring that statistical inferences remain valid when analyzing a large number of events.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.multitest</span> <span class="kn">import</span> <span class="n">multipletests</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">finds.database</span> <span class="kn">import</span> <span class="n">SQL</span><span class="p">,</span> <span class="n">RedisDB</span>
<span class="kn">from</span> <span class="nn">finds.structured</span> <span class="kn">import</span> <span class="n">BusDay</span><span class="p">,</span> <span class="n">Benchmarks</span><span class="p">,</span> <span class="n">Stocks</span><span class="p">,</span> <span class="n">CRSP</span><span class="p">,</span> <span class="n">PSTAT</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">CRSP_DATE</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">VERBOSE</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
<span class="c1">#%matplotlib qt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># open connections</span>
<span class="n">sql</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;sql&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">bd</span> <span class="o">=</span> <span class="n">BusDay</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">rdb</span> <span class="o">=</span> <span class="n">RedisDB</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;redis&#39;</span><span class="p">])</span>
<span class="n">keydev</span> <span class="o">=</span> <span class="n">PSTAT</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">crsp</span> <span class="o">=</span> <span class="n">CRSP</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">rdb</span><span class="o">=</span><span class="n">rdb</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">bench</span> <span class="o">=</span> <span class="n">Benchmarks</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">imgdir</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="s1">&#39;events&#39;</span>
</pre></div>
</div>
</div>
</div>
<section id="abnormal-returns">
<h2>Abnormal returns<a class="headerlink" href="#abnormal-returns" title="Permalink to this heading">#</a></h2>
<p>Event studies analyze how stock returns respond to specific company events, such as mergers or public announcements. These studies examine deviations from expected returns, known as <strong>abnormal returns</strong>, in the days surrounding the news release.</p>
<p>Let the event date be <span class="math notranslate nohighlight">\(t = 0\)</span>, and define the stock return for firm <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t\)</span> as <span class="math notranslate nohighlight">\(R_{i,t}\)</span>. To provide a benchmark, we also compute the returns of a relevant market or sector index, denoted <span class="math notranslate nohighlight">\(R_{m,t}\)</span>. Then:</p>
<ul class="simple">
<li><p><strong>Abnormal returns (AR):</strong> The deviation of a stock’s return from the market return:
$<span class="math notranslate nohighlight">\( AR_{i,t} = R_{i,t} - R_{m,t}\)</span>$</p></li>
<li><p><strong>Average abnormal returns (AAR):</strong> The mean abnormal return across all firms:
$<span class="math notranslate nohighlight">\(
AAR_t = \dfrac{1}{N} \sum_i^N AR_{i,t}
\)</span>$</p></li>
<li><p><strong>Cumulative average abnormal returns (CAR):</strong> The sum of average abnormal returns over time:
$<span class="math notranslate nohighlight">\(
CAR_T = \sum_t AAR_t
\)</span>$</p></li>
<li><p><strong>Buy-and-hold average abnormal returns (BHAR):</strong> The average buy-and-hold abnormal returns across firms:
$<span class="math notranslate nohighlight">\(
BHAR_T = \dfrac{1}{N} \sum_i^N \left[ \prod_t (1+ AR_{i,t}) - \prod_t (1+ R_{m,t}) \right]
\)</span>$</p></li>
</ul>
<section id="announcement-effect">
<h3>Announcement effect<a class="headerlink" href="#announcement-effect" title="Permalink to this heading">#</a></h3>
<p>The <strong>announcement effect</strong> refers to the immediate stock price movement around a news release. The nature of this reaction varies:</p>
<ul class="simple">
<li><p>An <strong>efficient reaction</strong> occurs when the stock price stabilizes at its new level after the event.</p></li>
<li><p>An <strong>under-reaction</strong> happens when the price continues trending in the same direction post-announcement.</p></li>
<li><p>An <strong>over-reaction</strong> is when the price initially spikes but then reverses course.</p></li>
</ul>
<p>In historical data, pinpointing the exact announcement time can be challenging. To account for this uncertainty, studies often consider an <strong>announcement window</strong>, typically covering one day before and after the event.</p>
<ul class="simple">
<li><p>A <strong>pre-announcement drift</strong> may indicate information leakage before the official announcement.</p></li>
<li><p>A <strong>post-announcement drift</strong> may suggest that investors either under- or over-reacted to the news.</p></li>
</ul>
<p>When analyzing multiple events, researchers often aggregate returns for stocks with the same announcement date. However, Kolari et al. (2010) caution that even small correlations among abnormal returns can lead to significant over-rejection of the null hypothesis of zero abnormal returns. To correct for this cross-sectional dependence, the unbiased estimate of abnormal return variance is:</p>
<div class="math notranslate nohighlight">
\[
\sigma^{2} = \dfrac{s^2}{n} (1 + (n - 1) \hat{r})
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat{r}\)</span> is the average sample cross-sectional correlation of residuals,</p></li>
<li><p><span class="math notranslate nohighlight">\(s^2\)</span> is the (biased) cross-sectional standard deviation of abnormal returns.</p></li>
</ul>
<p>In the next subsection, we explore how cross-correlations can be be measured efficiently using the Fourier Transform technique from the field of signal processing.</p>
</section>
<section id="finds-eventstudy-module">
<h3>FinDS <code class="docutils literal notranslate"><span class="pre">eventstudy</span></code> module<a class="headerlink" href="#finds-eventstudy-module" title="Permalink to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">eventstudy</span></code> module in the FinDS package provides a comprehensive tool for analyzing announcement effects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">finds.backtesting</span> <span class="kn">import</span> <span class="n">EventStudy</span>
<span class="n">eventstudy</span> <span class="o">=</span> <span class="n">EventStudy</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">bench</span><span class="o">=</span><span class="n">bench</span><span class="p">,</span> <span class="n">stocks</span><span class="o">=</span><span class="n">crsp</span><span class="p">,</span> <span class="n">max_date</span><span class="o">=</span><span class="n">CRSP_DATE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># event window parameters</span>
<span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">post</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">CRSP_DATE</span><span class="p">,</span> <span class="n">left</span> <span class="o">-</span> <span class="n">post</span><span class="p">)</span>
<span class="n">beg</span> <span class="o">=</span> <span class="mi">20020101</span>
<span class="n">mindays</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Retrieve event dates and company roles from CapitalIQ Key Developments</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sorted list of all eventids and roleids, provided in keydev class</span>
<span class="n">events</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keydev</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">roles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keydev</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># str formatter to pretty print descriptions, provided in keydev class</span>
<span class="n">eventformat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{event}</span><span class="s2"> (</span><span class="si">{eventid}</span><span class="s2">) </span><span class="si">{role}</span><span class="s2"> [</span><span class="si">{roleid}</span><span class="s2">]&quot;</span>\
    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="n">keydev</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="n">e</span><span class="p">],</span> <span class="n">eventid</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">keydev</span><span class="o">.</span><span class="n">role</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">roleid</span><span class="o">=</span><span class="n">r</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Helper functions to retrieve size decile of universe stocks</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Universe</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Helper to lookup prevailing size decile of universe stocks&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beg</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stocks</span><span class="p">:</span> <span class="n">Stocks</span><span class="p">,</span> <span class="n">annual</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="c1"># whether to offset previous month or year end when lookup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">stocks</span><span class="o">.</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span> <span class="k">if</span> <span class="n">annual</span> <span class="k">else</span> <span class="n">stocks</span><span class="o">.</span><span class="n">bd</span><span class="o">.</span><span class="n">endmo</span>
        
        <span class="c1"># populate dictionary, keyed by permno and date, with size decile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decile</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">date_range</span> <span class="o">=</span> <span class="n">stocks</span><span class="o">.</span><span class="n">bd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                                          <span class="n">freq</span><span class="o">=</span><span class="mi">12</span> <span class="k">if</span> <span class="n">annual</span> <span class="k">else</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_range</span><span class="p">:</span>
            <span class="n">univ</span> <span class="o">=</span> <span class="n">crsp</span><span class="o">.</span><span class="n">get_universe</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">permno</span> <span class="ow">in</span> <span class="n">univ</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">decile</span><span class="p">[(</span><span class="n">permno</span><span class="p">,</span> <span class="n">date</span><span class="p">)]</span> <span class="o">=</span> <span class="n">univ</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">permno</span><span class="p">,</span> <span class="s1">&#39;decile&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns size decile, else 0 if not universe stock&quot;&quot;&quot;</span>
        <span class="n">permno</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decile</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">permno</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>
    
<span class="n">univ</span> <span class="o">=</span> <span class="n">Universe</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">stocks</span><span class="o">=</span><span class="n">crsp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Define the event study pipeline:</p>
<ol class="arabic simple">
<li><p>retrieve announcement dates for the desired event and test period</p></li>
<li><p>filter the universe</p></li>
<li><p>retrieve announcement window daily stock returns, and compute event study metrics</p></li>
</ol>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run event study after screening stock universe</span>
<span class="k">def</span> <span class="nf">event_pipeline</span><span class="p">(</span><span class="n">eventstudy</span><span class="p">:</span> <span class="n">EventStudy</span><span class="p">,</span>
                   <span class="n">beg</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">eventid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">roleid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">post</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;helper to screen stock universe, and merge keydev events and crsp daily&quot;&quot;&quot;</span>

    <span class="c1"># Retrieve announcement dates for this event</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">keydev</span><span class="o">.</span><span class="n">get_linked</span><span class="p">(</span>
        <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;keydev&#39;</span><span class="p">,</span>
        <span class="n">date_field</span><span class="o">=</span><span class="s1">&#39;announcedate&#39;</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;keydevid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;keydeveventtypeid&#39;</span><span class="p">,</span>
                <span class="s1">&#39;keydevtoobjectroletypeid&#39;</span><span class="p">],</span>
        <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;announcedate &gt;= </span><span class="si">{</span><span class="n">beg</span><span class="si">}</span><span class="s2"> &quot;</span>
               <span class="sa">f</span><span class="s2">&quot;  and announcedate &lt;= </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span>
               <span class="sa">f</span><span class="s2">&quot;  and keydeveventtypeid = </span><span class="si">{</span><span class="n">eventid</span><span class="si">}</span><span class="s2"> &quot;</span>
               <span class="sa">f</span><span class="s2">&quot;  and keydevtoobjectroletypeid = </span><span class="si">{</span><span class="n">roleid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>\
               <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;announcedate&#39;</span><span class="p">])</span>\
               <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;permno&#39;</span><span class="p">,</span> <span class="s1">&#39;announcedate&#39;</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Require universe size decile</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">univ</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">permno</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">announcedate</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()]</span>

    <span class="c1"># Call eventstudy to compute daily abnormal returns, with named label</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">eventstudy</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">eventid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">roleid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                      <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span>
                      <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                      <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                      <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">,</span>
                      <span class="n">date_field</span><span class="o">=</span><span class="s1">&#39;announcedate&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">rows</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span> <span class="c1"># restrict successful rows</span>
</pre></div>
</div>
</div>
</div>
<p>Examine and show subsample plots for events that exhibited large post-announcement drift</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">93</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">232</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>  <span class="c1"># largest drift returns</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">eventid</span><span class="p">,</span> <span class="n">roleid</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">events_list</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">event_pipeline</span><span class="p">(</span><span class="n">eventstudy</span><span class="p">,</span>
                        <span class="n">eventid</span><span class="o">=</span><span class="n">eventid</span><span class="p">,</span>
                        <span class="n">roleid</span><span class="o">=</span><span class="n">roleid</span><span class="p">,</span>
                        <span class="n">beg</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span>
                        <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                        <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                        <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
    <span class="n">halfperiod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;announcedate&#39;</span><span class="p">])</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;First Half&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;announcedate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">halfperiod</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;Second Half&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;announcedate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ge</span><span class="p">(</span><span class="n">halfperiod</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;Large&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;Small&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;ALL&#39;</span><span class="p">:</span> <span class="p">[],</span>
             <span class="p">}</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                             <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ifig</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">ifig</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">clear</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ifig</span><span class="p">]</span>
        <span class="n">bhar</span> <span class="o">=</span> <span class="n">eventstudy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;sbhar&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
        <span class="n">eventstudy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;sbhar&#39;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">eventformat</span><span class="p">(</span><span class="n">eventid</span><span class="p">,</span> <span class="n">roleid</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">drift</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span> <span class="k">if</span> <span class="n">ifig</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="k">else</span> <span class="mi">10</span><span class="p">),</span>
                        <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="n">ifig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">imgdir</span> <span class="o">/</span> <span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">eventid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">roleid</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3e1170859fec60252b939ad95897246b6fa69e1028534feb23b7f3e13990f1b2.png" src="_images/3e1170859fec60252b939ad95897246b6fa69e1028534feb23b7f3e13990f1b2.png" />
<img alt="_images/da450c6656d14826e09f76716c3eef349878c6317ecd5ee51d12efdddeff4757.png" src="_images/da450c6656d14826e09f76716c3eef349878c6317ecd5ee51d12efdddeff4757.png" />
<img alt="_images/cdff7d45d42fd38d05c8c880d82bc1cfec5fbaa07d78a95916baa0146e2e55a6.png" src="_images/cdff7d45d42fd38d05c8c880d82bc1cfec5fbaa07d78a95916baa0146e2e55a6.png" />
<img alt="_images/386ff15cbf7bd0e7614f91a2c621e55fd368a04ae53c39a104484ae78fc689c2.png" src="_images/386ff15cbf7bd0e7614f91a2c621e55fd368a04ae53c39a104484ae78fc689c2.png" />
</div>
</div>
<p>Examine and show subsample plots for events that exhibited large announcement window returns</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">events_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">80</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># largest announcement window returns</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">eventid</span><span class="p">,</span> <span class="n">roleid</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">events_list</span><span class="p">):</span>
    <span class="c1">#eventid, roleid = 50, 1</span>
    <span class="c1">#eventid, roleid = 83, 1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">event_pipeline</span><span class="p">(</span><span class="n">eventstudy</span><span class="p">,</span>
                        <span class="n">eventid</span><span class="o">=</span><span class="n">eventid</span><span class="p">,</span>
                        <span class="n">roleid</span><span class="o">=</span><span class="n">roleid</span><span class="p">,</span>
                        <span class="n">beg</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span>
                        <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                        <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                        <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
    <span class="n">halfperiod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;announcedate&#39;</span><span class="p">])</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;FirstHalf&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;announcedate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="n">halfperiod</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;SecondHalf&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;announcedate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ge</span><span class="p">(</span><span class="n">halfperiod</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;Large&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;Small&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
              <span class="s1">&#39;ALL&#39;</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                             <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ifig</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">ifig</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">clear</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">ifig</span><span class="p">]</span>
        <span class="n">bhar</span> <span class="o">=</span> <span class="n">eventstudy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;sbhar&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">rows</span><span class="p">)</span>
        <span class="n">eventstudy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;sbhar&#39;</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">eventformat</span><span class="p">(</span><span class="n">eventid</span><span class="p">,</span> <span class="n">roleid</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">drift</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="n">ifig</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">imgdir</span> <span class="o">/</span> <span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">eventid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">roleid</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/19a0f0ae546105ec1c54aa2a422f1e5c26131cdbc4ad749a229fdc4b9df3f7d1.png" src="_images/19a0f0ae546105ec1c54aa2a422f1e5c26131cdbc4ad749a229fdc4b9df3f7d1.png" />
<img alt="_images/566160542b35dfba4690b531506d8203c7f301f51f5e97957c5db5e29397bad9.png" src="_images/566160542b35dfba4690b531506d8203c7f301f51f5e97957c5db5e29397bad9.png" />
<img alt="_images/3c774c0026daf0df60120b1e292a02222443fe64ffc891b943f758f35e8e798b.png" src="_images/3c774c0026daf0df60120b1e292a02222443fe64ffc891b943f758f35e8e798b.png" />
<img alt="_images/bd5ab79d8544b96b60737bb081eb655269031184732c93420346aff4a7960e2a.png" src="_images/bd5ab79d8544b96b60737bb081eb655269031184732c93420346aff4a7960e2a.png" />
</div>
</div>
</section>
</section>
<section id="fourier-transforms">
<h2>Fourier transforms<a class="headerlink" href="#fourier-transforms" title="Permalink to this heading">#</a></h2>
<section id="cross-sectional-correlations">
<h3>Cross-sectional Correlations<a class="headerlink" href="#cross-sectional-correlations" title="Permalink to this heading">#</a></h3>
<p>Kolari et al. (2018) address event windows that <strong>partially overlap in calendar time</strong>. To account for this overlap and cross-sectional correlation effects, they adjust the variance estimate as follows:</p>
<div class="math notranslate nohighlight">
\[
\sigma^{2} = \dfrac{s^2}{n} m (1 + \tau (n - 1) \rho)
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( m \)</span> = length of the event window,</p></li>
<li><p><span class="math notranslate nohighlight">\( \tau \)</span> = proportion of overlapping days between event windows,</p></li>
<li><p><span class="math notranslate nohighlight">\( \rho \)</span> = ratio of average covariance between abnormal returns to their variance.</p></li>
</ul>
<p>If all events share the same calendar date, such that all event windows fully overlap, then <span class="math notranslate nohighlight">\( \rho \)</span> simplifies to the average cross-sectional correlation of residuals during the estimation period.</p>
<p>To estimate <span class="math notranslate nohighlight">\( \rho \)</span>, we assume cross-sectional correlations arise mainly from time misalignment. By shifting and aligning event window residuals for each stock pair to maximize their correlation, we approximate <span class="math notranslate nohighlight">\( \rho \)</span> as the average of these best-aligned correlations.  We leverage the methodology of Fourier transforms and convolutions to effeciently compute all pairs of correlations.</p>
</section>
<section id="fast-fourier-transforms">
<h3>Fast Fourier Transforms<a class="headerlink" href="#fast-fourier-transforms" title="Permalink to this heading">#</a></h3>
<p>Fourier transforms allow us to express a time series (or any function) as a sum of sinusoids. Given a function over an interval of length ( L ), we can decompose it into sinusoidal components with periods ( L, L/2, L/3, ) etc. Each component has:</p>
<ul class="simple">
<li><p>A magnitude (scale factor)</p></li>
<li><p>A phase (shift)</p></li>
<li><p>A frequency (inverse of the period)</p></li>
</ul>
<p>This means that any function can be represented as a weighted sum of sinusoidal waves. By using complex numbers, we can efficiently store and manipulate these sinusoidal components in Fourier space rather than the original time domain. The <strong>Fast Fourier Transform (FFT)</strong> is an efficient algorithm for computing the <strong>Discrete Fourier Transform (DFT)</strong>. The DFT converts a sequence of time-domain data points into its sinusoidal coefficients, converting it from real space to frequency space. The <strong>Inverse Fast Fourier Transform</strong> reconstructs the original function.</p>
</section>
<section id="convolution-theorem">
<h3>Convolution Theorem<a class="headerlink" href="#convolution-theorem" title="Permalink to this heading">#</a></h3>
<p><strong>Convolution</strong> is a mathematical operation that combines two functions (<span class="math notranslate nohighlight">\( f \)</span> and <span class="math notranslate nohighlight">\( g \)</span>) to produce a third function (<span class="math notranslate nohighlight">\( f * g \)</span>), expressing how one function modifies the other:</p>
<div class="math notranslate nohighlight">
\[
(f * g)(t) = \int_{-\infty}^{\infty} f(s) g(t - s) ds
\]</div>
<p>In <strong>one dimension</strong>, convolution acts like a <strong>moving average</strong>, smoothing a time series by weighting neighboring values. In <strong>two dimensions</strong>, it applies filters (e.g., blurring, edge detection) in image processing.</p>
<p>In signal processing, frequency-domain techniques efficiently compute cross-correlations across various time shifts. Instead of directly computing correlations for every possible lag (which is computationally expensive), we leverage the <strong>Convolution Theorem</strong>. A key property of Fourier transforms is that convolution in the time domain corresponds to multiplication in the frequency domain.</p>
<div class="math notranslate nohighlight">
\[
\mathcal{F}\{f(t) * g(t)\} = \mathcal{F}\{f(t)\} \mathcal{F}\{g(t)\}
\]</div>
<p>Since direct convolution requires <span class="math notranslate nohighlight">\(O(N^2)\)</span> operations, computing it directly is slow. However:</p>
<ol class="arabic simple">
<li><p>We can first apply the Fast Fourier Transform (FFT) to convert both functions into frequency space in <span class="math notranslate nohighlight">\(O(N \log N)\)</span> time.</p></li>
<li><p>In frequency space, convolution is just element-wise multiplication of Fourier coefficients, which is very fast.</p></li>
<li><p>We then apply the Inverse FFT (IFFT) to obtain the final result in <span class="math notranslate nohighlight">\(O(N \log N)\)</span> time.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># best alignment and cross-correlation using convolution theorem method</span>
<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">rfft</span><span class="p">,</span> <span class="n">irfft</span>
<span class="k">def</span> <span class="nf">fft_align</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Find best alignment, max cross-correlation and indices of all pairs of columns&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_normalize</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Helper to demean columns and divide by norm&quot;&quot;&quot;</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">_normalize</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)])</span>  <span class="c1"># normalize and zero pad</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>              <span class="c1"># FFT of all series flipped</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">rfft</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                         <span class="c1"># FFT of all original series</span>
    <span class="n">corr</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>               <span class="c1"># to accumulate results</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># at each iter: compute column col * all remaining columns</span>
        <span class="n">conv</span> <span class="o">=</span> <span class="n">irfft</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="p">[</span><span class="n">col</span><span class="p">]]</span> <span class="o">*</span> <span class="n">Y</span><span class="p">[:,</span> <span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># inverse of product of FFT</span>
        <span class="n">corr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>           <span class="c1"># displacement location relative to center</span>
        <span class="n">disp</span><span class="o">.</span><span class="n">extend</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">shift</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span><span class="p">)</span> <span class="o">-</span> <span class="n">shift</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">col</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">corr</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">cols</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">fft_align</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>([0.9998967076018761], [1], [(0, 1)])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#fft_align(np.hstack(np.hstack((Z[:-5], Z[5:])))[:,2:], Z[:-2]) </span>
<span class="n">fft_align</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Z</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="mi">5</span><span class="p">:]))[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">Z</span><span class="p">[</span><span class="mi">7</span><span class="p">:])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>([0.9997503757740265, 0.9993943885689067, 0.9996440440611477],
 [5, 7, 2],
 [(0, 1), (0, 2), (1, 2)])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="multiple-testing">
<h2>Multiple testing<a class="headerlink" href="#multiple-testing" title="Permalink to this heading">#</a></h2>
<p>When testing a huge number of null hypotheses, we are bound to get
some very testing small p-values by chance.  <strong>Data snooping</strong> occurs when the analyst fits a great number of models to a dataset. When explanatory variables are selected using the data,
t-ratios and F-ratios will be too large, thus overstating the
importance of variables in the model. <strong>Multiple testing</strong> adjusts the hurdle for significance because some tests will appear significant by chance. The downside of doing this is that some truly significant strategies might be overlooked because they
did not pass the more stringent hurdle. This is the classic tension between Type I errors and Type II errors. The Type I error is the false discovery (investing in an unprofitable trading strategy). The Type II error is missing a truly profitable trading strategy.</p>
<p>The <strong>Family-Wise Error Rate (FWER)</strong> controls the probability of making <strong>at least one</strong> false discovery. If all <span class="math notranslate nohighlight">\( m \)</span> null hypotheses are independent and true:</p>
<div class="math notranslate nohighlight">
\[
\mathrm{FWER}(\alpha) = 1 - (1 - \alpha)^m
\]</div>
<p>To maintain a stricter significance threshold, the <strong>Bonferroni correction</strong> divides the confidence level by the number of tests:</p>
<div class="math notranslate nohighlight">
\[
\alpha' = \frac{\alpha}{m}
\]</div>
<p>This ensures that across multiple tests, the probability of making even <strong>one</strong> false discovery remains below <span class="math notranslate nohighlight">\( \alpha \)</span>. However, it can be overly conservative.</p>
<p>The <strong>false discovery rate (FDR)</strong> controls the proportion of false positives among rejected hypotheses. The <strong>Benjamini-Hochberg (BH) procedure</strong> is a widely used method for FDR control. Instead of adjusting individual significance thresholds like Bonferroni, BH ranks p-values and sets a significance cutoff where false discoveries remain within acceptable limits.</p>
<p>Compute BHAR and CAR of all events</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">restart_event</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># 75,1</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">eventid</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">events</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">eventid</span> <span class="o">&lt;=</span> <span class="n">restart_event</span><span class="p">:</span>  <span class="c1"># kludge to resume loop</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">roleid</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
        <span class="c1"># retrieve all returns observations of this eventid, roleid</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">event_pipeline</span><span class="p">(</span><span class="n">eventstudy</span><span class="p">,</span>
                            <span class="n">beg</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span>
                            <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
                            <span class="n">eventid</span><span class="o">=</span><span class="n">eventid</span><span class="p">,</span>
                            <span class="n">roleid</span><span class="o">=</span><span class="n">roleid</span><span class="p">,</span>
                            <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                            <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                            <span class="n">post</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;announcedate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">mindays</span><span class="p">:</span>  <span class="c1"># require min number of dates</span>
            <span class="k">continue</span>

        <span class="c1"># compute both BHAR and CAR averages, then plot and save</span>
        <span class="n">bhar</span> <span class="o">=</span> <span class="n">eventstudy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;sbhar&#39;</span><span class="p">)</span>
        <span class="n">car</span> <span class="o">=</span> <span class="n">eventstudy</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;scar&#39;</span><span class="p">)</span>
        <span class="c1">#eventstudy.write()</span>
        <span class="n">eventstudy</span><span class="o">.</span><span class="n">write_summary</span><span class="p">()</span>
        <span class="c1">#print(eventstudy.label, eventid, roleid)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eventstudy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;sbhar&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">eventformat</span><span class="p">(</span><span class="n">eventid</span><span class="p">,</span> <span class="n">roleid</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; BHAR&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">vline</span><span class="o">=</span><span class="p">[</span><span class="n">right</span><span class="p">])</span>
        <span class="n">eventstudy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;scar&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">eventformat</span><span class="p">(</span><span class="n">eventid</span><span class="p">,</span> <span class="n">roleid</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; CAR&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">vline</span><span class="o">=</span><span class="p">[</span><span class="n">right</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">imgdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">eventid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">roleid</span><span class="si">}</span><span class="s2">.jpg&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 45%|████▍     | 52/116 [20:04:50&lt;22:46:35, 1281.17s/it]/home/terence/Dropbox/github/data-science-notebooks/finds/recipes/filters.py:28: RuntimeWarning: invalid value encountered in divide
  X = X / np.linalg.norm(X, axis=0)
 53%|█████▎    | 62/116 [23:27:18&lt;18:41:48, 1246.45s/it]/home/terence/Dropbox/github/data-science-notebooks/finds/recipes/filters.py:28: RuntimeWarning: invalid value encountered in divide
  X = X / np.linalg.norm(X, axis=0)
 61%|██████    | 71/116 [26:38:56&lt;16:18:29, 1304.66s/it]/home/terence/Dropbox/github/data-science-notebooks/finds/recipes/filters.py:28: RuntimeWarning: invalid value encountered in divide
  X = X / np.linalg.norm(X, axis=0)
100%|██████████| 116/116 [42:41:25&lt;00:00, 1324.87s/it]  
</pre></div>
</div>
<img alt="_images/9a3a3be5ed054409b6e417b4d5e05529cce744a2c8e8737ca972445db82e4704.png" src="_images/9a3a3be5ed054409b6e417b4d5e05529cce744a2c8e8737ca972445db82e4704.png" />
</div>
</div>
<p>Summarize BHAR’s of all events</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create (eventid, roleid) multiindex for table of all BHAR&#39;s</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">eventstudy</span><span class="o">.</span><span class="n">read_summary</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;sbhar&#39;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;created&#39;</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;effective&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">400</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;post_t&#39;</span><span class="p">)</span>  <span class="c1"># sorted by post drift t-stat</span>
<span class="n">multiIndex</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">multiIndex</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;eventid&#39;</span><span class="p">,</span> <span class="s1">&#39;roleid&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keydev</span><span class="o">.</span><span class="n">event</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;role&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keydev</span><span class="o">.</span><span class="n">role</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Post-Announcement Drift&quot;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;role&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Post-Announcement Drift
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>beg</th>
      <th>end</th>
      <th>rows</th>
      <th>days</th>
      <th>effective</th>
      <th>window</th>
      <th>window_t</th>
      <th>post</th>
      <th>post_t</th>
    </tr>
    <tr>
      <th>event</th>
      <th>role</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Shelf Registration Filings</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>46949</td>
      <td>5666</td>
      <td>681.0</td>
      <td>-0.005224</td>
      <td>-2.542320</td>
      <td>-0.012755</td>
      <td>-2.753130</td>
    </tr>
    <tr>
      <th>Special/Extraordinary Shareholders Meeting</th>
      <th>Target</th>
      <td>20040106</td>
      <td>20241127</td>
      <td>6183</td>
      <td>3353</td>
      <td>534.0</td>
      <td>-0.002029</td>
      <td>-0.537886</td>
      <td>-0.018210</td>
      <td>-1.970180</td>
    </tr>
    <tr>
      <th>Name Changes</th>
      <th>Target</th>
      <td>20020430</td>
      <td>20241121</td>
      <td>1563</td>
      <td>1329</td>
      <td>454.0</td>
      <td>0.012626</td>
      <td>1.944510</td>
      <td>-0.023076</td>
      <td>-1.968600</td>
    </tr>
    <tr>
      <th>Changes in Company Bylaws/Rules</th>
      <th>Target</th>
      <td>20020430</td>
      <td>20241127</td>
      <td>27834</td>
      <td>4825</td>
      <td>592.0</td>
      <td>-0.000070</td>
      <td>-0.024033</td>
      <td>-0.010242</td>
      <td>-1.815650</td>
    </tr>
    <tr>
      <th>Product-Related Announcements</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>209897</td>
      <td>5767</td>
      <td>686.0</td>
      <td>0.005712</td>
      <td>4.608120</td>
      <td>-0.004112</td>
      <td>-1.607030</td>
    </tr>
    <tr>
      <th>M&amp;A Transaction Closings</th>
      <th>Target</th>
      <td>20020108</td>
      <td>20241125</td>
      <td>1508</td>
      <td>1234</td>
      <td>430.0</td>
      <td>0.010726</td>
      <td>1.184190</td>
      <td>-0.019140</td>
      <td>-1.506510</td>
    </tr>
    <tr>
      <th>Auditor Changes</th>
      <th>Target</th>
      <td>20020103</td>
      <td>20241127</td>
      <td>9563</td>
      <td>3888</td>
      <td>609.0</td>
      <td>-0.003402</td>
      <td>-1.173250</td>
      <td>-0.009535</td>
      <td>-1.433420</td>
    </tr>
    <tr>
      <th>Executive/Board Changes - Other</th>
      <th>Target</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>222258</td>
      <td>5766</td>
      <td>685.0</td>
      <td>-0.000533</td>
      <td>-0.537347</td>
      <td>-0.003171</td>
      <td>-1.410500</td>
    </tr>
    <tr>
      <th>Executive Changes - CFO</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>22715</td>
      <td>5544</td>
      <td>677.0</td>
      <td>-0.007618</td>
      <td>-3.312440</td>
      <td>-0.006563</td>
      <td>-1.390520</td>
    </tr>
    <tr>
      <th>Business Expansions</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>58224</td>
      <td>5709</td>
      <td>688.0</td>
      <td>0.002006</td>
      <td>1.663570</td>
      <td>-0.003755</td>
      <td>-1.327890</td>
    </tr>
    <tr>
      <th>Special Calls</th>
      <th>Target</th>
      <td>20030211</td>
      <td>20241127</td>
      <td>16738</td>
      <td>4501</td>
      <td>597.0</td>
      <td>0.014764</td>
      <td>1.100980</td>
      <td>-0.014743</td>
      <td>-1.257180</td>
    </tr>
    <tr>
      <th>Executive Changes - CEO</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>17079</td>
      <td>5269</td>
      <td>671.0</td>
      <td>-0.005253</td>
      <td>-1.572760</td>
      <td>-0.007032</td>
      <td>-1.120140</td>
    </tr>
    <tr>
      <th>M&amp;A Transaction Cancellations</th>
      <th>Buyer</th>
      <td>20020107</td>
      <td>20241122</td>
      <td>1508</td>
      <td>1258</td>
      <td>455.0</td>
      <td>-0.000106</td>
      <td>-0.019428</td>
      <td>-0.010588</td>
      <td>-1.037350</td>
    </tr>
    <tr>
      <th>Client Announcements</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>212795</td>
      <td>5761</td>
      <td>687.0</td>
      <td>0.008237</td>
      <td>7.380600</td>
      <td>-0.002300</td>
      <td>-0.908251</td>
    </tr>
    <tr>
      <th>Follow-on Equity Offerings</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>21917</td>
      <td>5219</td>
      <td>667.0</td>
      <td>-0.030227</td>
      <td>-5.005380</td>
      <td>-0.007275</td>
      <td>-0.892820</td>
    </tr>
    <tr>
      <th>Investor Activism - Target Communication</th>
      <th>Target</th>
      <td>20020402</td>
      <td>20241127</td>
      <td>5248</td>
      <td>3059</td>
      <td>525.0</td>
      <td>0.008690</td>
      <td>2.362150</td>
      <td>-0.004881</td>
      <td>-0.801679</td>
    </tr>
    <tr>
      <th>Earnings Calls</th>
      <th>Target</th>
      <td>20020108</td>
      <td>20241127</td>
      <td>236084</td>
      <td>5442</td>
      <td>654.0</td>
      <td>0.000499</td>
      <td>0.481335</td>
      <td>-0.002042</td>
      <td>-0.761636</td>
    </tr>
    <tr>
      <th>Strategic Alliances</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>29517</td>
      <td>5463</td>
      <td>679.0</td>
      <td>0.010685</td>
      <td>2.626260</td>
      <td>-0.003538</td>
      <td>-0.741016</td>
    </tr>
    <tr>
      <th>Lawsuits &amp; Legal Issues</th>
      <th>Target</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>41158</td>
      <td>5599</td>
      <td>682.0</td>
      <td>-0.000897</td>
      <td>-0.413061</td>
      <td>-0.002723</td>
      <td>-0.677482</td>
    </tr>
    <tr>
      <th>Investor Activism - Activist Communication</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241126</td>
      <td>8556</td>
      <td>3875</td>
      <td>576.0</td>
      <td>0.014757</td>
      <td>4.288130</td>
      <td>-0.004063</td>
      <td>-0.657731</td>
    </tr>
    <tr>
      <th>Corporate Guidance - Lowered</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241126</td>
      <td>10996</td>
      <td>3606</td>
      <td>583.0</td>
      <td>-0.066909</td>
      <td>-14.887900</td>
      <td>-0.002680</td>
      <td>-0.590799</td>
    </tr>
    <tr>
      <th>Private Placements</th>
      <th>Buyer</th>
      <td>20020103</td>
      <td>20241127</td>
      <td>11631</td>
      <td>4362</td>
      <td>645.0</td>
      <td>0.000440</td>
      <td>0.272817</td>
      <td>-0.002208</td>
      <td>-0.569800</td>
    </tr>
    <tr>
      <th>M&amp;A Transaction Announcements</th>
      <th>Seller</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>12325</td>
      <td>4804</td>
      <td>662.0</td>
      <td>0.009878</td>
      <td>2.630630</td>
      <td>-0.002869</td>
      <td>-0.472392</td>
    </tr>
    <tr>
      <th>M&amp;A Transaction Closings</th>
      <th>Buyer</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>43177</td>
      <td>5699</td>
      <td>687.0</td>
      <td>0.004541</td>
      <td>3.186290</td>
      <td>-0.001394</td>
      <td>-0.464066</td>
    </tr>
    <tr>
      <th>Company Conference Presentations</th>
      <th>Target</th>
      <td>20041101</td>
      <td>20241127</td>
      <td>339716</td>
      <td>4975</td>
      <td>592.0</td>
      <td>0.001272</td>
      <td>1.292770</td>
      <td>-0.001116</td>
      <td>-0.455673</td>
    </tr>
    <tr>
      <th>M&amp;A Calls</th>
      <th>Target</th>
      <td>20031027</td>
      <td>20241125</td>
      <td>7218</td>
      <td>3305</td>
      <td>566.0</td>
      <td>0.059589</td>
      <td>8.955770</td>
      <td>-0.002523</td>
      <td>-0.436285</td>
    </tr>
    <tr>
      <th>Index Constituent Adds</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>29372</td>
      <td>2248</td>
      <td>517.0</td>
      <td>-0.004618</td>
      <td>-1.557500</td>
      <td>-0.002675</td>
      <td>-0.417274</td>
    </tr>
    <tr>
      <th>Buyback Transaction Closings</th>
      <th>Target</th>
      <td>20020103</td>
      <td>20241123</td>
      <td>13012</td>
      <td>3913</td>
      <td>620.0</td>
      <td>0.003593</td>
      <td>1.725140</td>
      <td>-0.001955</td>
      <td>-0.416104</td>
    </tr>
    <tr>
      <th>M&amp;A Rumors and Discussions</th>
      <th>Target</th>
      <td>20020918</td>
      <td>20241127</td>
      <td>21747</td>
      <td>4605</td>
      <td>584.0</td>
      <td>0.013315</td>
      <td>4.876590</td>
      <td>-0.001790</td>
      <td>-0.409002</td>
    </tr>
    <tr>
      <th>Shareholder/Analyst Calls</th>
      <th>Target</th>
      <td>20020108</td>
      <td>20241127</td>
      <td>24420</td>
      <td>4417</td>
      <td>585.0</td>
      <td>0.001265</td>
      <td>0.428922</td>
      <td>-0.002059</td>
      <td>-0.313663</td>
    </tr>
    <tr>
      <th>Labor-related Announcements</th>
      <th>Target</th>
      <td>20020111</td>
      <td>20241121</td>
      <td>3975</td>
      <td>2485</td>
      <td>485.0</td>
      <td>0.001723</td>
      <td>0.546605</td>
      <td>-0.002090</td>
      <td>-0.306394</td>
    </tr>
    <tr>
      <th>Business Reorganizations</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241122</td>
      <td>4398</td>
      <td>2766</td>
      <td>519.0</td>
      <td>-0.001773</td>
      <td>-0.381681</td>
      <td>-0.002317</td>
      <td>-0.301770</td>
    </tr>
    <tr>
      <th>Conferences</th>
      <th>Participant</th>
      <td>20070125</td>
      <td>20241127</td>
      <td>296636</td>
      <td>3676</td>
      <td>451.0</td>
      <td>-0.000775</td>
      <td>-0.643617</td>
      <td>-0.000928</td>
      <td>-0.281036</td>
    </tr>
    <tr>
      <th>M&amp;A Transaction Announcements</th>
      <th>Buyer</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>25352</td>
      <td>5501</td>
      <td>682.0</td>
      <td>0.010533</td>
      <td>3.253760</td>
      <td>-0.001108</td>
      <td>-0.268724</td>
    </tr>
    <tr>
      <th>Delayed SEC Filings</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>13297</td>
      <td>2078</td>
      <td>519.0</td>
      <td>-0.017189</td>
      <td>-3.797660</td>
      <td>-0.001306</td>
      <td>-0.113672</td>
    </tr>
    <tr>
      <th>Earnings Release Date</th>
      <th>Target</th>
      <td>20020411</td>
      <td>20241127</td>
      <td>226653</td>
      <td>5294</td>
      <td>632.0</td>
      <td>-0.000074</td>
      <td>-0.071140</td>
      <td>-0.000190</td>
      <td>-0.069660</td>
    </tr>
    <tr>
      <th>M&amp;A Transaction Closings</th>
      <th>Seller</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>18467</td>
      <td>5138</td>
      <td>672.0</td>
      <td>0.003516</td>
      <td>1.461850</td>
      <td>-0.000303</td>
      <td>-0.069015</td>
    </tr>
    <tr>
      <th>M&amp;A Transaction Announcements</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241126</td>
      <td>6089</td>
      <td>3557</td>
      <td>622.0</td>
      <td>0.234380</td>
      <td>18.265800</td>
      <td>-0.000214</td>
      <td>-0.028792</td>
    </tr>
    <tr>
      <th>Discontinued Operations/Downsizings</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>18782</td>
      <td>4447</td>
      <td>594.0</td>
      <td>-0.009840</td>
      <td>-2.844410</td>
      <td>-0.000069</td>
      <td>-0.010337</td>
    </tr>
    <tr>
      <th>Fixed Income Offerings</th>
      <th>Target</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>28237</td>
      <td>5403</td>
      <td>677.0</td>
      <td>-0.004932</td>
      <td>-2.922310</td>
      <td>0.000168</td>
      <td>0.047205</td>
    </tr>
    <tr>
      <th>Corporate Guidance - New/Confirmed</th>
      <th>Target</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>148835</td>
      <td>5649</td>
      <td>687.0</td>
      <td>-0.001445</td>
      <td>-0.883251</td>
      <td>0.000366</td>
      <td>0.133957</td>
    </tr>
    <tr>
      <th>Private Placements</th>
      <th>Target</th>
      <td>20020103</td>
      <td>20241127</td>
      <td>15216</td>
      <td>5057</td>
      <td>657.0</td>
      <td>0.023461</td>
      <td>4.328510</td>
      <td>0.002351</td>
      <td>0.223887</td>
    </tr>
    <tr>
      <th>Seeking Acquisitions/Investments</th>
      <th>Target</th>
      <td>20020103</td>
      <td>20241125</td>
      <td>37787</td>
      <td>5239</td>
      <td>668.0</td>
      <td>-0.000697</td>
      <td>-0.305334</td>
      <td>0.001316</td>
      <td>0.366793</td>
    </tr>
    <tr>
      <th>Board Meeting</th>
      <th>Target</th>
      <td>20020204</td>
      <td>20241120</td>
      <td>6563</td>
      <td>2705</td>
      <td>473.0</td>
      <td>0.002824</td>
      <td>0.980749</td>
      <td>0.002164</td>
      <td>0.375795</td>
    </tr>
    <tr>
      <th>Considering Multiple Strategic Alternatives</th>
      <th>Target</th>
      <td>20040324</td>
      <td>20241122</td>
      <td>4017</td>
      <td>2491</td>
      <td>479.0</td>
      <td>-0.008435</td>
      <td>-1.135750</td>
      <td>0.012629</td>
      <td>0.556299</td>
    </tr>
    <tr>
      <th>Announcements of Sales/Trading Statement</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241119</td>
      <td>12367</td>
      <td>3306</td>
      <td>588.0</td>
      <td>0.004235</td>
      <td>1.329410</td>
      <td>0.005084</td>
      <td>0.662073</td>
    </tr>
    <tr>
      <th>Debt Financing Related</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>41158</td>
      <td>5708</td>
      <td>684.0</td>
      <td>0.004347</td>
      <td>2.013270</td>
      <td>0.002883</td>
      <td>0.696258</td>
    </tr>
    <tr>
      <th>Annual General Meeting</th>
      <th>Target</th>
      <td>20020122</td>
      <td>20241127</td>
      <td>71528</td>
      <td>5094</td>
      <td>620.0</td>
      <td>0.001460</td>
      <td>0.950287</td>
      <td>0.004452</td>
      <td>0.760826</td>
    </tr>
    <tr>
      <th>Seeking to Sell/Divest</th>
      <th>Target</th>
      <td>20020110</td>
      <td>20241125</td>
      <td>5250</td>
      <td>2922</td>
      <td>504.0</td>
      <td>-0.002623</td>
      <td>-0.531814</td>
      <td>0.006912</td>
      <td>0.809188</td>
    </tr>
    <tr>
      <th>End of Lock-Up Period</th>
      <th>Target</th>
      <td>20020115</td>
      <td>20241126</td>
      <td>7107</td>
      <td>3293</td>
      <td>565.0</td>
      <td>-0.060075</td>
      <td>-9.088620</td>
      <td>0.007541</td>
      <td>1.033670</td>
    </tr>
    <tr>
      <th>Buyback Tranche Update</th>
      <th>Target</th>
      <td>20020107</td>
      <td>20241127</td>
      <td>113233</td>
      <td>5073</td>
      <td>646.0</td>
      <td>0.000906</td>
      <td>0.559217</td>
      <td>0.002991</td>
      <td>1.077510</td>
    </tr>
    <tr>
      <th>Announcements of Earnings</th>
      <th>Target</th>
      <td>20020101</td>
      <td>20241127</td>
      <td>343641</td>
      <td>5712</td>
      <td>685.0</td>
      <td>0.000446</td>
      <td>0.305990</td>
      <td>0.002854</td>
      <td>1.128810</td>
    </tr>
    <tr>
      <th>Analyst/Investor Day</th>
      <th>Target</th>
      <td>20040204</td>
      <td>20241126</td>
      <td>6664</td>
      <td>3353</td>
      <td>548.0</td>
      <td>0.008374</td>
      <td>3.238440</td>
      <td>0.006292</td>
      <td>1.208400</td>
    </tr>
    <tr>
      <th>Investor Activism - Proxy/Voting Related</th>
      <th>Target</th>
      <td>20020107</td>
      <td>20241126</td>
      <td>7449</td>
      <td>3165</td>
      <td>530.0</td>
      <td>-0.001100</td>
      <td>-0.472323</td>
      <td>0.011292</td>
      <td>1.211770</td>
    </tr>
    <tr>
      <th>Delistings</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241127</td>
      <td>17906</td>
      <td>4928</td>
      <td>625.0</td>
      <td>-0.020833</td>
      <td>-3.871270</td>
      <td>0.016593</td>
      <td>1.223670</td>
    </tr>
    <tr>
      <th>Impairments/Write Offs</th>
      <th>Target</th>
      <td>20020408</td>
      <td>20241126</td>
      <td>23529</td>
      <td>3527</td>
      <td>521.0</td>
      <td>-0.003683</td>
      <td>-1.122100</td>
      <td>0.008273</td>
      <td>1.460700</td>
    </tr>
    <tr>
      <th>Corporate Guidance - Raised</th>
      <th>Target</th>
      <td>20020103</td>
      <td>20241126</td>
      <td>20044</td>
      <td>4162</td>
      <td>631.0</td>
      <td>0.033832</td>
      <td>11.737600</td>
      <td>0.006226</td>
      <td>1.547110</td>
    </tr>
    <tr>
      <th>Index Constituent Drops</th>
      <th>Target</th>
      <td>20020107</td>
      <td>20241126</td>
      <td>18202</td>
      <td>3039</td>
      <td>507.0</td>
      <td>-0.003266</td>
      <td>-0.751127</td>
      <td>0.017488</td>
      <td>1.557680</td>
    </tr>
    <tr>
      <th>Buyback - Change in Plan Terms</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241126</td>
      <td>6897</td>
      <td>3412</td>
      <td>605.0</td>
      <td>0.009150</td>
      <td>3.837660</td>
      <td>0.008018</td>
      <td>1.846240</td>
    </tr>
    <tr>
      <th>Buyback Transaction Announcements</th>
      <th>Target</th>
      <td>20020102</td>
      <td>20241126</td>
      <td>20353</td>
      <td>4996</td>
      <td>666.0</td>
      <td>0.015343</td>
      <td>7.037260</td>
      <td>0.008389</td>
      <td>2.327460</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Expected p-values (with continuity correction)</span>
<span class="n">pvals</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;post_t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">())</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pvals</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">),</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">pvals</span><span class="p">)],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distribution of p-values&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;actual&#39;</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2a99e49161800cdf0be577f76ab1cbac626082b0d7ec66f074306f76d9ca2530.png" src="_images/2a99e49161800cdf0be577f76ab1cbac626082b0d7ec66f074306f76d9ca2530.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of rejections with uncorrected pvals</span>
<span class="c1">#argmin = np.argmin(pvals)</span>
<span class="c1">#header = df.iloc[argmin][[&#39;event&#39;, &#39;role&#39;, &#39;days&#39;, &#39;effective&#39;, &#39;post_t&#39;]]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">uncorrected</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rejections&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pvals</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">),</span>
                         <span class="s1">&#39;min p-value&#39;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">pvals</span><span class="p">)},</span>
                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;uncorrected&#39;</span><span class="p">])</span>
<span class="n">uncorrected</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rejections</th>
      <th>min p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>uncorrected</th>
      <td>4</td>
      <td>0.0059</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="bonferroni-correction">
<h3>Bonferroni correction<a class="headerlink" href="#bonferroni-correction" title="Permalink to this heading">#</a></h3>
<p>The best-known FWER test is called the Bonferroni test which adjusts for the multiple tests. Given the chance that one test could randomly show up as significant, the Bonferroni requires the confidence level to increase. Instead of 5%, you take the 5% and divide by the number of tests, that is, 5%/10 = 0.5%. Again equivalently, you need to be 99.5% confident with 10 tests that you are not making a single false discovery. In terms of the t-statistic, the Bonferroni requires a statistic of at least 2.8 for 10 tests. For 1,000 tests, the statistic must exceed 4.1.</p>
<p>It sets the threshold for rejecting each hypothesis to <span class="math notranslate nohighlight">\(\alpha/m\)</span>, by applying the union bound inequality:</p>
<div class="math notranslate nohighlight">
\[\mathrm{FWER}(\alpha) = \mathrm{Pr}(\cup_{j=1}^{m} A_j) \le                                  
  \sum_{j=1}^{m} \mathrm{Pr}(A_j) \le m \times \frac{\alpha}{m} = \alpha\]</div>
<p>where <span class="math notranslate nohighlight">\(A_j\)</span> denotes the probability of rejecting the <span class="math notranslate nohighlight">\(j\)</span>-th
hypothesis. The Bonferroni correction can be quite conservative, in
the sense that the true FWER is often quite a bit lower than the
nominal (or target) FWER;</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The Bonferroni p-values bonf are simply the uncorrected pvalues multiplied by</span>
<span class="c1"># the number of samples and truncated to be less than or equal to 1.  </span>
<span class="n">reject</span><span class="p">,</span> <span class="n">bonf_corrected</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span>  <span class="n">multipletests</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">)</span>
<span class="n">bonf</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rejections&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bonf_corrected</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">),</span>
                  <span class="s1">&#39;min p-value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bonf_corrected</span><span class="p">)},</span>
                 <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bonferroni&#39;</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">uncorrected</span><span class="p">,</span> <span class="n">bonf</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rejections</th>
      <th>min p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>uncorrected</th>
      <td>4</td>
      <td>0.0059</td>
    </tr>
    <tr>
      <th>bonferroni</th>
      <td>0</td>
      <td>0.3542</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="holm-s-step-down-procedure">
<h3>Holm’s step-down procedure<a class="headerlink" href="#holm-s-step-down-procedure" title="Permalink to this heading">#</a></h3>
<p>Holm’s method, also known as Holm’s step-down procedure or the Holm-Bonferroni method, is an alternative to the Bonferroni procedure. Holm’s method method controls the FWER, but it is less conservative than Bonferroni, in the sense that it will reject more null hypotheses, typically resulting in fewer Type II errors and hence greater power. Holm’s method makes no independence assumptions about the hypothesis tests, and is uniformly more powerful than the Bonferroni method – it will always reject at least as many null hypotheses as Bonferroni– and so it should always be preferred. It is worth noting that in Holm’s procedure, the threshold that we use to reject each null hypothesis actually depends on the values of all the p-values.</p>
<p>The Holm method begins by sorting the tests from the lowest p-value (most significant) to the highest (least significant), and comparing a threshold computed with the Holm function.  In contrast to the Bonferroni, which has a single threshold for all tests, the other tests will have a different hurdle under Holm. Starting from the first test, we sequentially compare the p-values with their hurdles. When we first come across the test such that its p-value fails to meet the hurdle, we reject this test and all others with higher p-values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Holm method</span>
<span class="n">reject</span><span class="p">,</span> <span class="n">holm_corrected</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span>  <span class="n">multipletests</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;holm&#39;</span><span class="p">)</span>
<span class="n">holm</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rejections&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">holm_corrected</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">),</span>
                  <span class="s1">&#39;min p-value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">holm_corrected</span><span class="p">)},</span>
                 <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;holm&#39;</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">uncorrected</span><span class="p">,</span> <span class="n">bonf</span><span class="p">,</span> <span class="n">holm</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rejections</th>
      <th>min p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>uncorrected</th>
      <td>4</td>
      <td>0.0059</td>
    </tr>
    <tr>
      <th>bonferroni</th>
      <td>0</td>
      <td>0.3542</td>
    </tr>
    <tr>
      <th>holm</th>
      <td>0</td>
      <td>0.3542</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="benjamin-hochberg-procedure">
<h3>Benjamin-Hochberg procedure<a class="headerlink" href="#benjamin-hochberg-procedure" title="Permalink to this heading">#</a></h3>
<p>The false discovery rate approach allows an expected proportional error rate.  As such, it is less stringent than both the Bonferroni and the Holm test. FDR control is much milder – and more powerful – than FWER control, in the sense that it allows us to reject many more null hypotheses, with a cost of substantially more false positives.</p>
<p>Similar to the Holm test, Benjamin-Hochberg also relies on the distribution of test statistics. However, in contrast to the Holm test that begins with the most significant test, the Benjamin-Hochberg approach starts with the least significant.
We sort the tests from the lowest p-value (most significant) to the highest (least significant). Starting from the last test, we sequentially compare the p-values with their Benjamin-Hochberg thresholds. When we first come across the test such that its p-value falls below its threshold, we declare this test significant and all tests that have a lower p-value.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">multipletests</span></code> function can be used to carry out the Benjamini–Hochberg procedure.  The q-values output by the Benjamini–Hochberg procedure can be interpreted as the smallest FDR threshold at which we would reject a particular null hypothesis. For instance, a q-value of 0.1 indicates that we can reject the
corresponding null hypothesis at an FDR of 10% or greater, but that we cannot reject the null hypothesis at an FDR below 10%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Benjamini-Hochberg method</span>
<span class="n">reject</span><span class="p">,</span> <span class="n">fdr_bh_corrected</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span>  <span class="n">multipletests</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fdr_bh&#39;</span><span class="p">)</span>
<span class="n">fdr_bh</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rejections&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">fdr_bh_corrected</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">),</span>
                    <span class="s1">&#39;min p-value&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fdr_bh_corrected</span><span class="p">)},</span>
                   <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fdr_bh&#39;</span><span class="p">])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">uncorrected</span><span class="p">,</span> <span class="n">bonf</span><span class="p">,</span> <span class="n">holm</span><span class="p">,</span> <span class="n">fdr_bh</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rejections</th>
      <th>min p-value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>uncorrected</th>
      <td>4</td>
      <td>0.0059</td>
    </tr>
    <tr>
      <th>bonferroni</th>
      <td>0</td>
      <td>0.3542</td>
    </tr>
    <tr>
      <th>holm</th>
      <td>0</td>
      <td>0.3542</td>
    </tr>
    <tr>
      <th>fdr_bh</th>
      <td>0</td>
      <td>0.3542</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot uncorrected and corrected p-values from Benjamini-Hochberg method</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pvals</span><span class="p">,</span> <span class="n">fdr_bh_corrected</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Benjamini–Hochberg method to control the FDR at alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;uncorrected p-values&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Benjamini–Hochberg corrected p-values&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/329413f0ae07de8672f040f66a44c1a1b9a5f46fa29eb6d0bb2cf0c6c166d689.png" src="_images/329413f0ae07de8672f040f66a44c1a1b9a5f46fa29eb6d0bb2cf0c6c166d689.png" />
</div>
</div>
<p><strong>References</strong></p>
<p>Kolari, James W. and Pynnonen, Seppo, 2010, “Event Study Testing with Cross-sectional Correlation of Abnormal Returns”. The Review of Financial Studies, 23(11), 3996-4025</p>
<p>Kolari, James W., Paper, Bernd, and Pynnonen, Seppo, 2018, “Event Study Testing with Cross-sectional Correlation Due to Partially Overlapping Event Windows”, working paper</p>
<p>MacKinlay, A. Craig “Event Studies in Economics and Finance”, Journal of Economic Literature, March 1997.</p>
<p><em>MIT License.  Copyright 2021-2025 Terence Lim</em></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="1.6_quant_factors.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Quant Factors</p>
      </div>
    </a>
    <a class="right-next"
       href="2.1_economic_indicators.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Economic Indicators</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abnormal-returns">Abnormal returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#announcement-effect">Announcement effect</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finds-eventstudy-module">FinDS <code class="docutils literal notranslate"><span class="pre">eventstudy</span></code> module</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-transforms">Fourier transforms</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-sectional-correlations">Cross-sectional Correlations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fast-fourier-transforms">Fast Fourier Transforms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#convolution-theorem">Convolution Theorem</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-testing">Multiple testing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bonferroni-correction">Bonferroni correction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holm-s-step-down-procedure">Holm’s step-down procedure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#benjamin-hochberg-procedure">Benjamin-Hochberg procedure</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Terence Lim
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020-2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>